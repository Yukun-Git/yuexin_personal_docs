# pigeon_web æµ‹è¯•æ–¹æ¡ˆè®¾è®¡æ–‡æ¡£

## æ–‡æ¡£ä¿¡æ¯

- **åˆ›å»ºæ—¶é—´**: 2025-10-11
- **ä½œè€…**: yukun.xing
- **çŠ¶æ€**: Draft - å¾…å›¢é˜ŸReview
- **ç‰ˆæœ¬**: v1.0

---

## ä¸€ã€èƒŒæ™¯ä¸ç›®æ ‡

### 1.1 å½“å‰æµ‹è¯•ç°çŠ¶

**åç«¯æµ‹è¯•**ï¼š
- å­˜åœ¨ä¸€å®šé‡çš„å•å…ƒæµ‹è¯•å’ŒAPIæµ‹è¯•
- ä½¿ç”¨ pytest + unittest.mock
- SQLiteå†…å­˜æ•°æ®åº“
- è¦†ç›–è®¤è¯ã€SMSã€é€šé“ç­‰æ ¸å¿ƒæ¨¡å—

**å‰ç«¯æµ‹è¯•**ï¼š
- å‡ ä¹æ²¡æœ‰æµ‹è¯•ï¼ˆä»…1ä¸ªå·¥å…·å‡½æ•°æµ‹è¯•ï¼‰
- å·²é…ç½®vitestä½†æœªå……åˆ†ä½¿ç”¨

**ç¼ºå¤±**ï¼š
- ç¼ºå°‘ç«¯åˆ°ç«¯(E2E)æµ‹è¯•
- ç¼ºå°‘çœŸå®çš„å‰åç«¯é›†æˆæµ‹è¯•
- å•å…ƒæµ‹è¯•ç»´æŠ¤æˆæœ¬é«˜ï¼ˆAIé¢‘ç¹é‡æ„ä»£ç å¯¼è‡´æµ‹è¯•å¤±æ•ˆï¼‰

### 1.2 è®¾è®¡ç›®æ ‡

1. **é€‚åº”AIè¾…åŠ©å¼€å‘** - å‡å°‘è„†å¼±çš„å•å…ƒæµ‹è¯•ï¼Œå¢åŠ è¡Œä¸ºéªŒè¯æµ‹è¯•
2. **æå‡æµ‹è¯•ROI** - é‡ç‚¹æŠ•å…¥APIæµ‹è¯•å’Œå…³é”®E2Eæµ‹è¯•
3. **ä¿è¯ä»£ç è´¨é‡** - é€šè¿‡API+E2Eæµ‹è¯•è¦†ç›–å®ç°é«˜è´¨é‡ä¿è¯
4. **ä¸å¹²æ‰°å¼€å‘æµç¨‹** - æœ¬åœ°å¼€å‘ç¯å¢ƒä¸æµ‹è¯•ç¯å¢ƒå®Œå…¨éš”ç¦»
5. **CIå‹å¥½** - æµ‹è¯•å¯åœ¨CIç¯å¢ƒè‡ªåŠ¨è¿è¡Œ

### 1.3 æ ¸å¿ƒç­–ç•¥

```
æµ‹è¯•é‡‘å­—å¡”ï¼ˆä¼ ç»Ÿï¼‰              æµ‹è¯•é‡‘å­—å¡”ï¼ˆæˆ‘ä»¬çš„ç­–ç•¥ï¼‰
     /\                              /\
    /  \  E2E (5%)                  /  \  E2E (30%)
   /----\                          /----\
  / API  \ (15%)                  / API  \ (60%)
 /--------\                      /--------\
/   Unit   \ (80%)              /   Unit   \ (10%)
-------------                   -------------
     X ä¸é€‚åˆAIå¼€å‘                  âœ“ é€‚åˆAIå¼€å‘
```

**ç­–ç•¥è¯´æ˜**ï¼š
- **å¤§å¹…å‡å°‘å•å…ƒæµ‹è¯•** - ä»…ä¿ç•™æ ¸å¿ƒç®—æ³•å’Œç¨³å®šå·¥å…·å‡½æ•°çš„æµ‹è¯•
- **é‡ç‚¹æŠ•å…¥APIæµ‹è¯•** - éªŒè¯ä¸šåŠ¡é€»è¾‘ï¼Œè¦†ç›–70%+ APIç«¯ç‚¹
- **å…³é”®E2Eæµ‹è¯•** - è¦†ç›–æ ¸å¿ƒç”¨æˆ·è·¯å¾„ï¼Œä¿è¯ç«¯åˆ°ç«¯è´¨é‡
- **å®Œå…¨éš”ç¦»** - E2Eæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹Dockerç¯å¢ƒï¼Œä¸å½±å“å¼€å‘

---

## äºŒã€æµ‹è¯•åˆ†å±‚è®¾è®¡

### 2.1 ä¸‰å±‚æµ‹è¯•æ¶æ„

| æµ‹è¯•å±‚çº§ | æµ‹è¯•å¯¹è±¡ | è¿è¡Œç¯å¢ƒ | é€Ÿåº¦ | æ—¥å¸¸ä½¿ç”¨é¢‘ç‡ | è¦†ç›–ç›®æ ‡ |
|---------|---------|---------|------|------------|---------|
| **Unit** | çº¯å‡½æ•°ã€ç®—æ³• | æ— ä¾èµ–/å…¨Mock | æå¿«(ç§’) | ä¸­ | 10% |
| **API** | åç«¯APIç«¯ç‚¹ | Flask + æµ‹è¯•DB | å¿«(ç§’) | é«˜ | 60% |
| **E2E** | å®Œæ•´ç”¨æˆ·æµç¨‹ | Dockerç‹¬ç«‹ç¯å¢ƒ | æ…¢(åˆ†é’Ÿ) | ä½ | 30% |

### 2.2 æ¯å±‚æµ‹è¯•çš„èŒè´£

#### Unit Testsï¼ˆå•å…ƒæµ‹è¯•ï¼‰- æœ€å°åŒ–ä¿ç•™

**æµ‹è¯•ä»€ä¹ˆ**ï¼š
- âœ… æ ¸å¿ƒè®¡ç®—é€»è¾‘ï¼ˆå¦‚è®¡è´¹ç®—æ³•ã€çŸ­ä¿¡æ‹†åˆ†é€»è¾‘ï¼‰
- âœ… ç¨³å®šçš„å·¥å…·å‡½æ•°ï¼ˆå¦‚æ—¥æœŸæ ¼å¼åŒ–ã€æ•°æ®è½¬æ¢ï¼‰
- âœ… çº¯å‡½æ•°ï¼ˆæ— å‰¯ä½œç”¨ï¼Œè¾“å…¥ç¡®å®šåˆ™è¾“å‡ºç¡®å®šï¼‰

**ä¸æµ‹è¯•ä»€ä¹ˆ**ï¼š
- âŒ ä¸šåŠ¡é€»è¾‘ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰
- âŒ æ•°æ®åº“äº¤äº’ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰
- âŒ HTTPè·¯ç”±ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰
- âŒ Reactç»„ä»¶ï¼ˆç»´æŠ¤æˆæœ¬é«˜ï¼Œä»·å€¼ä½ï¼‰

**ç¤ºä¾‹**ï¼š
```python
# tests/unit/backend/test_billing_calculator.py
def test_calculate_sms_cost():
    """æµ‹è¯•çŸ­ä¿¡è®¡è´¹ç®—æ³•"""
    cost = calculate_sms_cost(
        content_length=160,
        country_code='GB',
        rate_per_message=0.05
    )
    assert cost == 0.05
```

#### API Testsï¼ˆAPIé›†æˆæµ‹è¯•ï¼‰- æ ¸å¿ƒé‡ç‚¹

**æµ‹è¯•ä»€ä¹ˆ**ï¼š
- âœ… æ‰€æœ‰HTTP APIç«¯ç‚¹
- âœ… è¯·æ±‚å‚æ•°éªŒè¯
- âœ… ä¸šåŠ¡é€»è¾‘æ­£ç¡®æ€§
- âœ… æ•°æ®åº“CRUDæ“ä½œ
- âœ… æƒé™æ§åˆ¶
- âœ… é”™è¯¯å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨SQLiteå†…å­˜æ•°æ®åº“ï¼ˆå¿«é€Ÿï¼Œéš”ç¦»ï¼‰
- ä½¿ç”¨factory_boyç”Ÿæˆæµ‹è¯•æ•°æ®
- ä¸å¯åŠ¨å‰ç«¯ï¼Œç›´æ¥è°ƒç”¨Flask test client
- æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç‹¬ç«‹ï¼Œäº’ä¸å½±å“

**ç¤ºä¾‹**ï¼š
```python
# tests/api/sms/test_outbox_filter.py
def test_filter_by_country_code(client, auth_headers):
    """æµ‹è¯•æŒ‰å›½å®¶ç­›é€‰å‘ä»¶ç®±"""
    response = client.get(
        '/api/v1/sms/outbox?country_codes=GB&start_time=2025-01-01&end_time=2025-12-31',
        headers=auth_headers
    )

    assert response.status_code == 200
    data = response.json
    assert data['success'] is True

    # éªŒè¯æ‰€æœ‰è®°å½•éƒ½æ˜¯GB
    for record in data['data']['records']:
        assert record['countryCode'] == 'GB'
```

**è¦†ç›–ç›®æ ‡**ï¼š
- æ ¸å¿ƒAPIç«¯ç‚¹ï¼š100%è¦†ç›–
- è¾¹ç•Œæ¡ä»¶ï¼šæ¯ä¸ªAPIè‡³å°‘3-5ä¸ªæµ‹è¯•ç”¨ä¾‹
- é”™è¯¯åœºæ™¯ï¼š400/401/403/404/500 ç­‰

#### E2E Testsï¼ˆç«¯åˆ°ç«¯æµ‹è¯•ï¼‰- å…³é”®æµç¨‹ä¿éšœ

**æµ‹è¯•ä»€ä¹ˆ**ï¼š
- âœ… æ ¸å¿ƒç”¨æˆ·æ—…ç¨‹ï¼ˆç™»å½•â†’æ“ä½œâ†’æŸ¥çœ‹ç»“æœï¼‰
- âœ… è·¨æ¨¡å—åä½œæµç¨‹
- âœ… çœŸå®æµè§ˆå™¨äº¤äº’
- âœ… å‰åç«¯å®Œæ•´é›†æˆ

**ä¸æµ‹è¯•ä»€ä¹ˆ**ï¼š
- âŒ æ‰€æœ‰ç»†èŠ‚ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰
- âŒ è¾¹ç•Œæ¡ä»¶ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰
- âŒ é”™è¯¯å¤„ç†ç»†èŠ‚ï¼ˆäº¤ç»™APIæµ‹è¯•ï¼‰

**å…³é”®E2Eåœºæ™¯**ï¼ˆ5-10ä¸ªï¼‰ï¼š
1. ç”¨æˆ·ç™»å½• â†’ æŸ¥çœ‹å‘ä»¶ç®± â†’ æŒ‰å›½å®¶ç­›é€‰ â†’ æŸ¥çœ‹è¯¦æƒ…
2. ç”¨æˆ·ç™»å½• â†’ æŸ¥çœ‹æ”¶ä»¶ç®± â†’ å¯¼å‡ºæ•°æ®
3. ç®¡ç†å‘˜ç™»å½• â†’ åˆ›å»ºè´¦å· â†’ é…ç½®é€šé“ â†’ æŸ¥çœ‹è´¦å·åˆ—è¡¨
4. ç®¡ç†å‘˜ç™»å½• â†’ åˆ›å»ºé€šé“ â†’ é…ç½®å‘Šè­¦ â†’ æŸ¥çœ‹é€šé“çŠ¶æ€
5. ç”¨æˆ·ç™»å½• â†’ æŸ¥çœ‹ç»Ÿè®¡æŠ¥è¡¨ â†’ åˆ‡æ¢æ—¶é—´èŒƒå›´

**ç‰¹ç‚¹**ï¼š
- ä½¿ç”¨Playwrightè¿›è¡Œæµè§ˆå™¨è‡ªåŠ¨åŒ–
- ä½¿ç”¨ç‹¬ç«‹çš„Dockerç¯å¢ƒï¼ˆå®Œå…¨éš”ç¦»å¼€å‘ç¯å¢ƒï¼‰
- ä½¿ç”¨çœŸå®çš„PostgreSQLæµ‹è¯•æ•°æ®åº“
- ä½¿ç”¨Page Object Modelæ¨¡å¼ç»„ç»‡æµ‹è¯•ä»£ç 

**ç¤ºä¾‹**ï¼š
```typescript
// tests/e2e/tests/features/outbox/filter.spec.ts
test('ç”¨æˆ·å¯ä»¥æŒ‰å›½å®¶ç­›é€‰å‘ä»¶ç®±', async ({ page }) => {
  const outbox = new OutboxPage(page);

  await login(page, 'e2e_user', 'password');
  await outbox.goto();
  await outbox.selectCountry('GB');
  await outbox.clickQuery();

  const count = await outbox.getRecordCount();
  expect(count).toBeGreaterThan(0);
  await outbox.verifyAllRecordsHaveCountry('GB');
});
```

---

## ä¸‰ã€ç›®å½•ç»“æ„è®¾è®¡

```
pigeon/
â”œâ”€â”€ pigeon_web/                         # ä¸»é¡¹ç›®ä»£ç 
â”‚   â”œâ”€â”€ app/                            # åç«¯åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ frontend/                       # å‰ç«¯åº”ç”¨ä»£ç 
â”‚   â””â”€â”€ ...
â”‚
â””â”€â”€ tests/                              # æµ‹è¯•æ ¹ç›®å½•
    â”œâ”€â”€ README.md                       # æµ‹è¯•æ–‡æ¡£ï¼šå¦‚ä½•è¿è¡Œã€å¦‚ä½•ç¼–å†™
    â”œâ”€â”€ pytest.ini                      # pytesté…ç½®
    â”œâ”€â”€ .env.test                       # æµ‹è¯•ç¯å¢ƒå˜é‡
    â”œâ”€â”€ Makefile                        # æµ‹è¯•å‘½ä»¤å°è£…
    â”‚
    â”œâ”€â”€ fixtures/                       # å…±äº«çš„pytest fixtures
    â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”œâ”€â”€ database.py                 # æ•°æ®åº“ç›¸å…³fixtures
    â”‚   â”œâ”€â”€ auth.py                     # è®¤è¯ç›¸å…³fixtures
    â”‚   â””â”€â”€ test_data.py                # æµ‹è¯•æ•°æ®ç”Ÿæˆå™¨
    â”‚
    â”œâ”€â”€ shared/                         # è·¨æµ‹è¯•ç±»å‹çš„å…±äº«èµ„æº
    â”‚   â”œâ”€â”€ factories/                  # æ•°æ®å·¥å‚ï¼ˆfactory_boyï¼‰
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ user_factory.py
    â”‚   â”‚   â”œâ”€â”€ message_factory.py
    â”‚   â”‚   â”œâ”€â”€ account_factory.py
    â”‚   â”‚   â””â”€â”€ channel_factory.py
    â”‚   â”œâ”€â”€ helpers/                    # æµ‹è¯•è¾…åŠ©å‡½æ•°
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ api_client.py           # APIè°ƒç”¨å°è£…
    â”‚   â”‚   â”œâ”€â”€ assertions.py           # è‡ªå®šä¹‰æ–­è¨€
    â”‚   â”‚   â””â”€â”€ data_generators.py      # æ•°æ®ç”Ÿæˆå·¥å…·
    â”‚   â””â”€â”€ mock_data/                  # é™æ€æµ‹è¯•æ•°æ®
    â”‚       â”œâ”€â”€ messages.json
    â”‚       â”œâ”€â”€ accounts.json
    â”‚       â””â”€â”€ channels.json
    â”‚
    â”œâ”€â”€ unit/                           # å•å…ƒæµ‹è¯•ï¼ˆä¿ç•™å°‘é‡ï¼‰
    â”‚   â”œâ”€â”€ conftest.py                 # unitæµ‹è¯•ä¸“ç”¨fixtures
    â”‚   â”œâ”€â”€ backend/                    # åç«¯å•å…ƒæµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ test_query_builder.py   # SQLæŸ¥è¯¢æ„å»ºå™¨é€»è¾‘
    â”‚   â”‚   â”œâ”€â”€ test_validators.py      # æ•°æ®éªŒè¯å™¨
    â”‚   â”‚   â”œâ”€â”€ test_formatters.py      # æ•°æ®æ ¼å¼åŒ–å·¥å…·
    â”‚   â”‚   â””â”€â”€ test_billing.py         # è®¡è´¹ç®—æ³•ï¼ˆæ ¸å¿ƒé€»è¾‘ï¼‰
    â”‚   â””â”€â”€ frontend/                   # å‰ç«¯å•å…ƒæµ‹è¯•
    â”‚       â”œâ”€â”€ utils/
    â”‚       â”‚   â””â”€â”€ formatters.test.ts  # å·¥å…·å‡½æ•°æµ‹è¯•
    â”‚       â””â”€â”€ hooks/
    â”‚           â””â”€â”€ useAuth.test.ts     # è‡ªå®šä¹‰hooksæµ‹è¯•
    â”‚
    â”œâ”€â”€ api/                            # APIé›†æˆæµ‹è¯•ï¼ˆé‡ç‚¹ï¼‰
    â”‚   â”œâ”€â”€ conftest.py                 # APIæµ‹è¯•ä¸“ç”¨fixtures
    â”‚   â”œâ”€â”€ test_app.py                 # Flaskæµ‹è¯•åº”ç”¨é…ç½®
    â”‚   â”œâ”€â”€ init_test_db.sql            # æµ‹è¯•æ•°æ®åº“schemaåˆå§‹åŒ–
    â”‚   â”‚
    â”‚   â”œâ”€â”€ auth/                       # è®¤è¯æ¨¡å—APIæµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ test_login.py           # ç™»å½•åŠŸèƒ½
    â”‚   â”‚   â”œâ”€â”€ test_logout.py          # ç™»å‡ºåŠŸèƒ½
    â”‚   â”‚   â”œâ”€â”€ test_token_refresh.py   # Tokenåˆ·æ–°
    â”‚   â”‚   â”œâ”€â”€ test_permissions.py     # æƒé™éªŒè¯
    â”‚   â”‚   â””â”€â”€ test_password_reset.py  # å¯†ç é‡ç½®
    â”‚   â”‚
    â”‚   â”œâ”€â”€ sms/                        # çŸ­ä¿¡æ¨¡å—APIæµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ outbox/
    â”‚   â”‚   â”‚   â”œâ”€â”€ test_outbox_query.py      # å‘ä»¶ç®±æŸ¥è¯¢
    â”‚   â”‚   â”‚   â”œâ”€â”€ test_outbox_filter.py     # å‘ä»¶ç®±ç­›é€‰ï¼ˆé‡ç‚¹ï¼‰
    â”‚   â”‚   â”‚   â”œâ”€â”€ test_outbox_pagination.py # åˆ†é¡µåŠŸèƒ½
    â”‚   â”‚   â”‚   â”œâ”€â”€ test_outbox_sort.py       # æ’åºåŠŸèƒ½
    â”‚   â”‚   â”‚   â”œâ”€â”€ test_outbox_detail.py     # æ¶ˆæ¯è¯¦æƒ…
    â”‚   â”‚   â”‚   â””â”€â”€ test_outbox_export.py     # å¯¼å‡ºåŠŸèƒ½
    â”‚   â”‚   â””â”€â”€ inbox/
    â”‚   â”‚       â”œâ”€â”€ test_inbox_query.py       # æ”¶ä»¶ç®±æŸ¥è¯¢
    â”‚   â”‚       â”œâ”€â”€ test_inbox_filter.py      # æ”¶ä»¶ç®±ç­›é€‰
    â”‚   â”‚       â””â”€â”€ test_inbox_detail.py      # æ¶ˆæ¯è¯¦æƒ…
    â”‚   â”‚
    â”‚   â”œâ”€â”€ accounts/                   # è´¦å·ç®¡ç†APIæµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ test_account_crud.py    # è´¦å·å¢åˆ æ”¹æŸ¥
    â”‚   â”‚   â”œâ”€â”€ test_account_list.py    # è´¦å·åˆ—è¡¨æŸ¥è¯¢
    â”‚   â”‚   â””â”€â”€ test_account_settings.py # è´¦å·é…ç½®
    â”‚   â”‚
    â”‚   â”œâ”€â”€ channels/                   # é€šé“ç®¡ç†APIæµ‹è¯•
    â”‚   â”‚   â”œâ”€â”€ __init__.py
    â”‚   â”‚   â”œâ”€â”€ test_channel_crud.py    # é€šé“å¢åˆ æ”¹æŸ¥
    â”‚   â”‚   â”œâ”€â”€ test_channel_alert.py   # é€šé“å‘Šè­¦é…ç½®
    â”‚   â”‚   â””â”€â”€ test_channel_status.py  # é€šé“çŠ¶æ€æŸ¥è¯¢
    â”‚   â”‚
    â”‚   â””â”€â”€ management/                 # å…¶ä»–ç®¡ç†åŠŸèƒ½APIæµ‹è¯•
    â”‚       â”œâ”€â”€ __init__.py
    â”‚       â”œâ”€â”€ test_country_regions.py # å›½å®¶åŒºåŸŸç®¡ç†
    â”‚       â”œâ”€â”€ test_blacklist.py       # é»‘åå•ç®¡ç†
    â”‚       â”œâ”€â”€ test_whitelist.py       # ç™½åå•ç®¡ç†
    â”‚       â”œâ”€â”€ test_sender_mgmt.py     # Senderç®¡ç†
    â”‚       â””â”€â”€ test_pricing.py         # ä»·æ ¼ç®¡ç†
    â”‚
    â””â”€â”€ e2e/                            # ç«¯åˆ°ç«¯æµ‹è¯•
        â”œâ”€â”€ README.md                   # E2Eæµ‹è¯•æ–‡æ¡£
        â”œâ”€â”€ package.json                # PlaywrightåŠç›¸å…³ä¾èµ–
        â”œâ”€â”€ package-lock.json
        â”œâ”€â”€ playwright.config.ts        # Playwrighté…ç½®
        â”œâ”€â”€ tsconfig.json               # TypeScripté…ç½®
        â”‚
        â”œâ”€â”€ docker/                     # Dockerç¯å¢ƒé…ç½®
        â”‚   â”œâ”€â”€ docker-compose.e2e.yml  # Dockerç¼–æ’æ–‡ä»¶
        â”‚   â”œâ”€â”€ backend.Dockerfile      # åç«¯æµ‹è¯•é•œåƒ
        â”‚   â”œâ”€â”€ frontend.Dockerfile     # å‰ç«¯æµ‹è¯•é•œåƒ
        â”‚   â”œâ”€â”€ nginx.conf              # Nginxé…ç½®
        â”‚   â””â”€â”€ init-db.sql             # E2Eæµ‹è¯•æ•°æ®åˆå§‹åŒ–
        â”‚
        â”œâ”€â”€ fixtures/                   # E2Eæµ‹è¯•fixtures
        â”‚   â”œâ”€â”€ auth.ts                 # è®¤è¯ç›¸å…³ï¼ˆç™»å½•çŠ¶æ€ç®¡ç†ï¼‰
        â”‚   â”œâ”€â”€ test-data.ts            # æµ‹è¯•æ•°æ®helpers
        â”‚   â””â”€â”€ cleanup.ts              # æµ‹è¯•æ¸…ç†å·¥å…·
        â”‚
        â”œâ”€â”€ pages/                      # Page Object Model
        â”‚   â”œâ”€â”€ BasePage.ts             # åŸºç¡€é¡µé¢ç±»
        â”‚   â”œâ”€â”€ LoginPage.ts            # ç™»å½•é¡µ
        â”‚   â”œâ”€â”€ DashboardPage.ts        # é¦–é¡µ
        â”‚   â”œâ”€â”€ OutboxPage.ts           # å‘ä»¶ç®±é¡µ
        â”‚   â”œâ”€â”€ InboxPage.ts            # æ”¶ä»¶ç®±é¡µ
        â”‚   â”œâ”€â”€ AccountManagementPage.ts # è´¦å·ç®¡ç†é¡µ
        â”‚   â””â”€â”€ ChannelManagementPage.ts # é€šé“ç®¡ç†é¡µ
        â”‚
        â””â”€â”€ tests/                      # E2Eæµ‹è¯•ç”¨ä¾‹
            â”œâ”€â”€ smoke/                  # å†’çƒŸæµ‹è¯•ï¼ˆæœ€å…³é”®çš„æµç¨‹ï¼‰
            â”‚   â”œâ”€â”€ login.spec.ts       # ç™»å½•æµç¨‹
            â”‚   â””â”€â”€ critical-path.spec.ts # æ ¸å¿ƒä¸šåŠ¡è·¯å¾„
            â”‚
            â”œâ”€â”€ features/               # åŠŸèƒ½æµ‹è¯•
            â”‚   â”œâ”€â”€ outbox/
            â”‚   â”‚   â”œâ”€â”€ filter.spec.ts  # å‘ä»¶ç®±ç­›é€‰
            â”‚   â”‚   â”œâ”€â”€ export.spec.ts  # å‘ä»¶ç®±å¯¼å‡º
            â”‚   â”‚   â”œâ”€â”€ detail.spec.ts  # æ¶ˆæ¯è¯¦æƒ…æŸ¥çœ‹
            â”‚   â”‚   â””â”€â”€ pagination.spec.ts # åˆ†é¡µ
            â”‚   â”œâ”€â”€ inbox/
            â”‚   â”‚   â”œâ”€â”€ query.spec.ts   # æ”¶ä»¶ç®±æŸ¥è¯¢
            â”‚   â”‚   â””â”€â”€ filter.spec.ts  # æ”¶ä»¶ç®±ç­›é€‰
            â”‚   â””â”€â”€ management/
            â”‚       â”œâ”€â”€ accounts.spec.ts # è´¦å·ç®¡ç†
            â”‚       â””â”€â”€ channels.spec.ts # é€šé“ç®¡ç†
            â”‚
            â””â”€â”€ regression/             # å›å½’æµ‹è¯•ï¼ˆè®°å½•å†å²bugï¼‰
                â”œâ”€â”€ issue-001-outbox-filter-bug.spec.ts
                â””â”€â”€ issue-002-export-timeout.spec.ts
```

---

## å››ã€E2Eæµ‹è¯•ç¯å¢ƒéš”ç¦»æ–¹æ¡ˆï¼ˆé‡ç‚¹ï¼‰

### 4.1 é—®é¢˜ï¼šä¸å¼€å‘ç¯å¢ƒçš„å†²çª

**å¼€å‘ç¯å¢ƒ**ï¼ˆæ—¥å¸¸å¯åŠ¨ï¼Œç”¨äºæ‰‹å·¥æµ‹è¯•ï¼‰ï¼š
```
å‰ç«¯: http://localhost:5173
åç«¯: http://localhost:5000
æ•°æ®åº“: localhost:8668/pigeon_sms
```

**E2Eæµ‹è¯•ç¯å¢ƒ**ï¼ˆè¿è¡Œæµ‹è¯•æ—¶å¯åŠ¨ï¼‰ï¼š
```
å‰ç«¯: http://localhost:5174  â† ä¸åŒç«¯å£
åç«¯: http://localhost:5001  â† ä¸åŒç«¯å£
æ•°æ®åº“: localhost:5433/pigeon_sms_e2e  â† ä¸åŒç«¯å£å’Œæ•°æ®åº“
```

### 4.2 è§£å†³æ–¹æ¡ˆï¼šç‹¬ç«‹Dockerç¯å¢ƒ

**æ ¸å¿ƒæ€æƒ³**ï¼šE2Eæµ‹è¯•ä½¿ç”¨å®Œå…¨ç‹¬ç«‹çš„Dockerå®¹å™¨ï¼Œä¸æœ¬åœ°å¼€å‘ç¯å¢ƒé›¶å†²çªã€‚

```yaml
# tests/e2e/docker/docker-compose.e2e.yml
version: '3.8'

services:
  # PostgreSQLæµ‹è¯•æ•°æ®åº“
  postgres-e2e:
    image: postgres:16
    container_name: pigeon-e2e-postgres
    environment:
      POSTGRES_USER: yuexin
      POSTGRES_PASSWORD: test_password
      POSTGRES_DB: pigeon_sms_e2e
    ports:
      - "5433:5432"  # æ˜ å°„åˆ°ä¸åŒçš„ç«¯å£ï¼Œé¿å…å†²çª
    volumes:
      - ./init-db.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U yuexin"]
      interval: 5s
      timeout: 5s
      retries: 5
    networks:
      - e2e-network

  # åç«¯APIæœåŠ¡
  backend-e2e:
    build:
      context: ../../../pigeon_web
      dockerfile: ../tests/e2e/docker/backend.Dockerfile
    container_name: pigeon-e2e-backend
    environment:
      FLASK_ENV: e2e_testing
      DATABASE_URL: postgresql://yuexin:test_password@postgres-e2e:5432/pigeon_sms_e2e
      SECRET_KEY: e2e-test-secret-key
      JWT_SECRET_KEY: e2e-jwt-secret
    ports:
      - "5001:5000"
    depends_on:
      postgres-e2e:
        condition: service_healthy
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5000/api/v1/health"]
      interval: 5s
      timeout: 5s
      retries: 10
    networks:
      - e2e-network

  # å‰ç«¯æœåŠ¡ï¼ˆç”Ÿäº§æ„å»º+Nginxï¼‰
  frontend-e2e:
    build:
      context: ../../../pigeon_web/frontend
      dockerfile: ../../../tests/e2e/docker/frontend.Dockerfile
    container_name: pigeon-e2e-frontend
    environment:
      VITE_API_BASE_URL: http://localhost:5001
    ports:
      - "5174:80"
    depends_on:
      backend-e2e:
        condition: service_healthy
    networks:
      - e2e-network

networks:
  e2e-network:
    name: pigeon-e2e-network
    driver: bridge
```

### 4.3 Dockerfileé…ç½®

```dockerfile
# tests/e2e/docker/backend.Dockerfile
FROM python:3.11-slim

WORKDIR /app

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    curl \
    && rm -rf /var/lib/apt/lists/*

# å¤åˆ¶å¹¶å®‰è£…Pythonä¾èµ–
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# å¤åˆ¶åº”ç”¨ä»£ç 
COPY . .

# æ·»åŠ å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¦‚æœæ²¡æœ‰çš„è¯ï¼‰
# HEALTHCHECK CMD curl -f http://localhost:5000/api/v1/health || exit 1

EXPOSE 5000

# å¯åŠ¨åº”ç”¨
CMD ["python", "run.py"]
```

```dockerfile
# tests/e2e/docker/frontend.Dockerfile
FROM node:20-alpine AS builder

WORKDIR /app

# å¤åˆ¶packageæ–‡ä»¶å¹¶å®‰è£…ä¾èµ–
COPY package*.json ./
RUN npm ci

# å¤åˆ¶æºä»£ç å¹¶æ„å»º
COPY . .
RUN npm run build

# ç”Ÿäº§ç¯å¢ƒï¼šä½¿ç”¨Nginxæä¾›é™æ€æ–‡ä»¶
FROM nginx:alpine

# å¤åˆ¶æ„å»ºäº§ç‰©
COPY --from=builder /app/dist /usr/share/nginx/html

# å¤åˆ¶Nginxé…ç½®
COPY ../../../tests/e2e/docker/nginx.conf /etc/nginx/conf.d/default.conf

EXPOSE 80

CMD ["nginx", "-g", "daemon off;"]
```

```nginx
# tests/e2e/docker/nginx.conf
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    # å‰ç«¯è·¯ç”±
    location / {
        try_files $uri $uri/ /index.html;
    }

    # APIä»£ç†ï¼ˆå¯é€‰ï¼Œå¦‚æœå‰ç«¯ç›´æ¥è°ƒç”¨backend-e2eå®¹å™¨ï¼‰
    # location /api {
    #     proxy_pass http://backend-e2e:5000;
    #     proxy_set_header Host $host;
    #     proxy_set_header X-Real-IP $remote_addr;
    #     proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    # }
}
```

### 4.4 æµ‹è¯•æ•°æ®åˆå§‹åŒ–

```sql
-- tests/e2e/docker/init-db.sql
-- 1. ä½¿ç”¨ä¸»æ•°æ®åº“schema
\i /docker-entrypoint-initdb.d/../../pigeon_web/sql/pigeon_web.sql

-- 2. æ’å…¥E2Eæµ‹è¯•ä¸“ç”¨æ•°æ®

-- æµ‹è¯•ç®¡ç†å‘˜è´¦å·
INSERT INTO admin_users (username, password_hash, email, is_active, created_at)
VALUES
  ('e2e_admin', '$2b$12$...', 'e2e_admin@test.com', true, NOW()),
  ('e2e_user', '$2b$12$...', 'e2e_user@test.com', true, NOW());

-- æµ‹è¯•å®¢æˆ·è´¦å·
INSERT INTO customers_accounts (account_id, name, enabled, created_at)
VALUES
  ('E2E_ACC_001', 'E2Eæµ‹è¯•è´¦å·1', true, NOW()),
  ('E2E_ACC_002', 'E2Eæµ‹è¯•è´¦å·2', true, NOW());

-- æµ‹è¯•é€šé“
INSERT INTO customers_channels (channel_id, channel_name, channel_type, enabled, created_at)
VALUES
  ('E2E_CH_001', 'E2Eæµ‹è¯•é€šé“1', 'SMPP', true, NOW()),
  ('E2E_CH_002', 'E2Eæµ‹è¯•é€šé“2', 'HTTP', true, NOW());

-- æµ‹è¯•çŸ­ä¿¡æ•°æ®ï¼ˆå‘ä»¶ç®±ï¼‰
INSERT INTO short_messages (
  message_id, account_id, status, country_code, phone_number,
  content, sender, channel_id, send_time, created_at
)
VALUES
  ('E2E_MSG_GB_001', 'E2E_ACC_001', 'ChannelSendSuccess', 'GB', '447700900001',
   'Test message to UK 1', 'TestSender', 'E2E_CH_001', NOW(), NOW()),
  ('E2E_MSG_GB_002', 'E2E_ACC_001', 'ChannelSendSuccess', 'GB', '447700900002',
   'Test message to UK 2', 'TestSender', 'E2E_CH_001', NOW(), NOW()),
  ('E2E_MSG_US_001', 'E2E_ACC_001', 'ChannelSendSuccess', 'US', '12025550123',
   'Test message to US 1', 'TestSender', 'E2E_CH_002', NOW(), NOW()),
  ('E2E_MSG_US_002', 'E2E_ACC_001', 'ChannelSendFailed', 'US', '12025550124',
   'Test message to US 2 failed', 'TestSender', 'E2E_CH_002', NOW(), NOW());

-- æµ‹è¯•çŸ­ä¿¡æ•°æ®ï¼ˆæ”¶ä»¶ç®±ï¼‰
INSERT INTO delivers (
  message_id, account_id, deliver_type, status, country_code,
  phone_number, content, receive_time, created_at
)
VALUES
  ('E2E_DELIVER_001', 'E2E_ACC_001', 'UplinkSMS', 'Processed', 'GB',
   '447700900001', 'Reply from UK user', NOW(), NOW()),
  ('E2E_DELIVER_002', 'E2E_ACC_001', 'Receipt', 'Processed', 'US',
   '12025550123', '', NOW(), NOW());
```

---

## äº”ã€è¿è¡Œæ–¹å¼

### 5.1 æ—¥å¸¸å¼€å‘å·¥ä½œæµ

```bash
# 1. æœ¬åœ°å¼€å‘ç¯å¢ƒï¼ˆä¸€ç›´è¿è¡Œï¼‰
# å¯åŠ¨æ•°æ®åº“
cd pigeon/deployment/docker/middleware/postgresql
docker-compose up -d

# å¯åŠ¨åç«¯
cd pigeon_web
source /Users/yukun-admin/projects/pigeon/venv/bin/activate
python run.py

# å¯åŠ¨å‰ç«¯
cd pigeon_web/frontend
npm run dev

# æµè§ˆå™¨è®¿é—® http://localhost:5173 è¿›è¡Œæ‰‹å·¥æµ‹è¯•
```

```bash
# 2. å¿«é€ŸéªŒè¯åç«¯é€»è¾‘ï¼ˆæ¨èï¼‰
cd pigeon/tests
pytest api/sms/test_outbox_filter.py -v

# è¿è¡Œæ‰€æœ‰APIæµ‹è¯•
pytest api/ -v --cov

# è¿è¡Œç‰¹å®šæ¨¡å—çš„APIæµ‹è¯•
pytest api/auth/ -v
pytest api/sms/ -v
```

```bash
# 3. é‡å¤§åŠŸèƒ½ä¸Šçº¿å‰ï¼Œè¿è¡ŒE2Eæµ‹è¯•ï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰
cd pigeon/tests
make e2e-test

# æˆ–è€…åˆ†æ­¥æ‰§è¡Œ
make e2e-up      # å¯åŠ¨E2Eç¯å¢ƒ
# æµè§ˆå™¨è®¿é—® http://localhost:5174 æ‰‹åŠ¨éªŒè¯
make e2e-test    # è¿è¡Œæµ‹è¯•
make e2e-down    # æ¸…ç†ç¯å¢ƒ
```

### 5.2 Makefileå‘½ä»¤å°è£…

```makefile
# tests/Makefile
.PHONY: help test-all test-unit test-api test-smoke test-e2e e2e-up e2e-down e2e-logs clean

# é»˜è®¤æ˜¾ç¤ºå¸®åŠ©
help:
	@echo "pigeon_web æµ‹è¯•å‘½ä»¤"
	@echo ""
	@echo "å¿«é€Ÿæµ‹è¯•ï¼ˆæ—¥å¸¸å¼€å‘ï¼‰ï¼š"
	@echo "  make test-api          - è¿è¡ŒAPIæµ‹è¯•ï¼ˆæ¨èï¼‰"
	@echo "  make test-unit         - è¿è¡Œå•å…ƒæµ‹è¯•"
	@echo ""
	@echo "E2Eæµ‹è¯•ï¼š"
	@echo "  make test-smoke        - è¿è¡Œå†’çƒŸæµ‹è¯•ï¼ˆ5-10åˆ†é’Ÿï¼‰"
	@echo "  make test-e2e          - è¿è¡Œå®Œæ•´E2Eæµ‹è¯•ï¼ˆ10-20åˆ†é’Ÿï¼‰"
	@echo "  make e2e-up            - å¯åŠ¨E2Eç¯å¢ƒï¼ˆè°ƒè¯•ç”¨ï¼‰"
	@echo "  make e2e-down          - åœæ­¢E2Eç¯å¢ƒ"
	@echo "  make e2e-logs          - æŸ¥çœ‹E2Eæ—¥å¿—"
	@echo ""
	@echo "å®Œæ•´æµ‹è¯•ï¼š"
	@echo "  make test-all          - è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆCIç”¨ï¼‰"
	@echo "  make clean             - æ¸…ç†æµ‹è¯•äº§ç‰©"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆCIç”¨ï¼‰
test-all: test-unit test-api test-e2e
	@echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"

# å•å…ƒæµ‹è¯•
test-unit:
	@echo "ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•..."
	pytest unit/ -v

# APIæµ‹è¯•ï¼ˆæ—¥å¸¸å¼€å‘æ¨èï¼‰
test-api:
	@echo "ğŸ§ª è¿è¡ŒAPIæµ‹è¯•..."
	pytest api/ -v --cov=../pigeon_web/app --cov-report=html --cov-report=term-missing
	@echo "ğŸ“Š è¦†ç›–ç‡æŠ¥å‘Š: tests/htmlcov/index.html"

# å†’çƒŸæµ‹è¯•ï¼ˆæœ€å¿«çš„E2Eï¼‰
test-smoke: e2e-up
	@echo "ğŸ§ª è¿è¡Œå†’çƒŸæµ‹è¯•..."
	cd e2e && npx playwright test --project=smoke
	@echo "ğŸ“Š æµ‹è¯•æŠ¥å‘Š: tests/e2e/playwright-report/index.html"

# å®Œæ•´E2Eæµ‹è¯•
test-e2e: e2e-up
	@echo "ğŸ§ª è¿è¡ŒE2Eæµ‹è¯•..."
	cd e2e && npx playwright test
	@echo "ğŸ“Š æµ‹è¯•æŠ¥å‘Š: tests/e2e/playwright-report/index.html"
	$(MAKE) e2e-down

# å¯åŠ¨E2Eç¯å¢ƒ
e2e-up:
	@echo "ğŸš€ å¯åŠ¨E2Eæµ‹è¯•ç¯å¢ƒ..."
	cd e2e/docker && docker-compose -f docker-compose.e2e.yml up -d --build
	@echo "â³ ç­‰å¾…æœåŠ¡å°±ç»ªï¼ˆçº¦30ç§’ï¼‰..."
	@sleep 30
	@echo "âœ… E2Eç¯å¢ƒå·²å¯åŠ¨"
	@echo "   å‰ç«¯: http://localhost:5174"
	@echo "   åç«¯: http://localhost:5001/api/v1/health"
	@echo "   æ•°æ®åº“: localhost:5433/pigeon_sms_e2e"

# åœæ­¢E2Eç¯å¢ƒ
e2e-down:
	@echo "ğŸ›‘ åœæ­¢E2Eç¯å¢ƒ..."
	cd e2e/docker && docker-compose -f docker-compose.e2e.yml down -v
	@echo "âœ… E2Eç¯å¢ƒå·²æ¸…ç†"

# æŸ¥çœ‹E2Eæ—¥å¿—
e2e-logs:
	@echo "ğŸ“‹ E2Eç¯å¢ƒæ—¥å¿—ï¼š"
	cd e2e/docker && docker-compose -f docker-compose.e2e.yml logs -f

# æ¸…ç†æµ‹è¯•äº§ç‰©
clean:
	@echo "ğŸ§¹ æ¸…ç†æµ‹è¯•äº§ç‰©..."
	find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
	find . -type d -name "*.pyc" -delete 2>/dev/null || true
	find . -type d -name ".pytest_cache" -exec rm -rf {} + 2>/dev/null || true
	rm -rf htmlcov/ .coverage 2>/dev/null || true
	rm -rf e2e/playwright-report/ e2e/test-results/ 2>/dev/null || true
	@echo "âœ… æ¸…ç†å®Œæˆ"
```

### 5.3 å¸¸ç”¨æµ‹è¯•å‘½ä»¤

```bash
# ============ æ—¥å¸¸å¼€å‘ ============

# å¿«é€ŸéªŒè¯æŸä¸ªAPIåŠŸèƒ½
pytest tests/api/sms/test_outbox_filter.py::test_filter_by_country -v

# è¿è¡ŒæŸä¸ªæ¨¡å—çš„æ‰€æœ‰APIæµ‹è¯•
pytest tests/api/sms/ -v

# è¿è¡ŒAPIæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/api/ --cov --cov-report=html

# ============ E2Eæµ‹è¯• ============

# è¿è¡ŒæŸä¸ªE2Eæµ‹è¯•æ–‡ä»¶
cd tests/e2e
make e2e-up
npx playwright test tests/features/outbox/filter.spec.ts

# è°ƒè¯•E2Eæµ‹è¯•ï¼ˆå¸¦æµè§ˆå™¨ç•Œé¢ï¼‰
npx playwright test --debug

# æŸ¥çœ‹E2Eæµ‹è¯•æŠ¥å‘Š
npx playwright show-report

# ============ CI ============

# CIç¯å¢ƒè¿è¡Œæ‰€æœ‰æµ‹è¯•
cd tests
make test-all
```

---

## å…­ã€CIé›†æˆæ–¹æ¡ˆ

### 6.1 GitHub Actionsé…ç½®

```yaml
# .github/workflows/test.yml
name: Tests

on:
  push:
    branches: [main, develop]
  pull_request:
    branches: [main, develop]

jobs:
  # Job 1: APIæµ‹è¯•ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
  api-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 10

    steps:
      - name: Checkoutä»£ç 
        uses: actions/checkout@v3

      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: å®‰è£…ä¾èµ–
        run: |
          cd pigeon_web
          pip install -r requirements.txt
          pip install pytest pytest-cov

      - name: è¿è¡ŒAPIæµ‹è¯•
        run: |
          cd tests
          pytest api/ -v --cov=../pigeon_web/app --cov-report=xml

      - name: ä¸Šä¼ è¦†ç›–ç‡æŠ¥å‘Š
        uses: codecov/codecov-action@v3
        with:
          files: ./tests/coverage.xml
          flags: api-tests

  # Job 2: E2Eæµ‹è¯•ï¼ˆè¾ƒæ…¢ï¼Œä½†ä¿è¯è´¨é‡ï¼‰
  e2e-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    steps:
      - name: Checkoutä»£ç 
        uses: actions/checkout@v3

      - name: è®¾ç½®Node.jsç¯å¢ƒ
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: å®‰è£…Playwright
        run: |
          cd tests/e2e
          npm ci
          npx playwright install --with-deps chromium

      - name: å¯åŠ¨E2Eç¯å¢ƒ
        run: |
          cd tests/e2e/docker
          docker-compose -f docker-compose.e2e.yml up -d --build
          sleep 30

      - name: è¿è¡ŒE2Eæµ‹è¯•
        run: |
          cd tests/e2e
          npx playwright test

      - name: ä¸Šä¼ æµ‹è¯•æŠ¥å‘Š
        if: always()
        uses: actions/upload-artifact@v3
        with:
          name: playwright-report
          path: tests/e2e/playwright-report/
          retention-days: 7

      - name: æ¸…ç†E2Eç¯å¢ƒ
        if: always()
        run: |
          cd tests/e2e/docker
          docker-compose -f docker-compose.e2e.yml down -v

  # Job 3: å•å…ƒæµ‹è¯•ï¼ˆå¯é€‰ï¼‰
  unit-tests:
    runs-on: ubuntu-latest
    timeout-minutes: 5

    steps:
      - name: Checkoutä»£ç 
        uses: actions/checkout@v3

      - name: è®¾ç½®Pythonç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: å®‰è£…ä¾èµ–
        run: |
          cd pigeon_web
          pip install -r requirements.txt
          pip install pytest

      - name: è¿è¡Œå•å…ƒæµ‹è¯•
        run: |
          cd tests
          pytest unit/ -v
```

### 6.2 æµ‹è¯•ç­–ç•¥

```yaml
# ä¸åŒåˆ†æ”¯çš„æµ‹è¯•ç­–ç•¥
mainåˆ†æ”¯ï¼ˆç”Ÿäº§ï¼‰:
  - è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆunit + api + e2eï¼‰
  - è¦æ±‚100%é€šè¿‡
  - ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š

developåˆ†æ”¯ï¼ˆå¼€å‘ï¼‰:
  - è¿è¡ŒAPIæµ‹è¯• + å†’çƒŸE2Eæµ‹è¯•
  - å…è®¸éƒ¨åˆ†æµ‹è¯•å¤±è´¥ï¼ˆæ ‡è®°ä¸ºflakyï¼‰

featureåˆ†æ”¯ï¼ˆç‰¹æ€§ï¼‰:
  - ä»…è¿è¡ŒAPIæµ‹è¯•
  - å¿«é€Ÿåé¦ˆ

PRï¼ˆPull Requestï¼‰:
  - è¿è¡ŒAPIæµ‹è¯• + ç›¸å…³çš„E2Eæµ‹è¯•
  - è¦æ±‚é€šè¿‡æ‰èƒ½åˆå¹¶
```

---

## ä¸ƒã€æœ€ä½³å®è·µ

### 7.1 ç¼–å†™æµ‹è¯•çš„åŸåˆ™

1. **æµ‹è¯•è¦ç‹¬ç«‹**ï¼šæ¯ä¸ªæµ‹è¯•ç”¨ä¾‹åº”è¯¥èƒ½å¤Ÿç‹¬ç«‹è¿è¡Œï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•çš„æ‰§è¡Œé¡ºåº
2. **æµ‹è¯•è¦å¿«é€Ÿ**ï¼šAPIæµ‹è¯•åº”åœ¨ç§’çº§å®Œæˆï¼ŒE2Eæµ‹è¯•åº”æ§åˆ¶åœ¨åˆ†é’Ÿçº§
3. **æµ‹è¯•è¦ç¨³å®š**ï¼šé¿å…flaky testsï¼ˆä¸ç¨³å®šçš„æµ‹è¯•ï¼‰ï¼Œç‰¹åˆ«æ˜¯E2Eæµ‹è¯•
4. **æµ‹è¯•è¦æ¸…æ™°**ï¼šæµ‹è¯•åç§°åº”æ¸…æ¥šæè¿°æµ‹è¯•å†…å®¹ï¼Œéµå¾ª `test_<åŠŸèƒ½>_<åœºæ™¯>_<é¢„æœŸç»“æœ>` æ ¼å¼
5. **æµ‹è¯•è¦èšç„¦**ï¼šæ¯ä¸ªæµ‹è¯•åªéªŒè¯ä¸€ä¸ªåŠŸèƒ½ç‚¹ï¼Œä¸è¦è´ªå¤š

### 7.2 APIæµ‹è¯•æœ€ä½³å®è·µ

```python
# âœ… å¥½çš„APIæµ‹è¯•ç¤ºä¾‹
def test_filter_outbox_by_country_returns_only_specified_country_records(
    client, auth_headers, db_session
):
    """æµ‹è¯•æŒ‰å›½å®¶ç­›é€‰å‘ä»¶ç®±ï¼Œåº”åªè¿”å›æŒ‡å®šå›½å®¶çš„è®°å½•"""
    # Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®
    MessageFactory.create(country_code='GB', account_id='TEST_001')
    MessageFactory.create(country_code='US', account_id='TEST_001')
    MessageFactory.create(country_code='GB', account_id='TEST_001')

    # Act: æ‰§è¡Œæ“ä½œ
    response = client.get(
        '/api/v1/sms/outbox?country_codes=GB&start_time=2025-01-01&end_time=2025-12-31',
        headers=auth_headers
    )

    # Assert: éªŒè¯ç»“æœ
    assert response.status_code == 200
    data = response.json
    assert data['success'] is True
    assert data['data']['pagination']['totalCount'] == 2

    for record in data['data']['records']:
        assert record['countryCode'] == 'GB'

# âŒ ä¸å¥½çš„æµ‹è¯•ç¤ºä¾‹ï¼ˆæµ‹è¯•å†…å®¹ä¸æ¸…æ™°ï¼ŒéªŒè¯ä¸å……åˆ†ï¼‰
def test_outbox(client, auth_headers):
    response = client.get('/api/v1/sms/outbox?country_codes=GB', headers=auth_headers)
    assert response.status_code == 200
```

**å‘½åè§„èŒƒ**ï¼š
- `test_<APIç«¯ç‚¹>_<æ“ä½œ>_<åœºæ™¯>_<é¢„æœŸç»“æœ>`
- ç¤ºä¾‹ï¼š`test_outbox_filter_by_invalid_country_returns_400`

**Arrange-Act-Assertæ¨¡å¼**ï¼š
```python
def test_example(client, auth_headers):
    # Arrange: å‡†å¤‡æµ‹è¯•æ•°æ®å’Œç¯å¢ƒ
    user = UserFactory.create()

    # Act: æ‰§è¡Œè¢«æµ‹è¯•çš„æ“ä½œ
    response = client.post('/api/v1/users', json={...}, headers=auth_headers)

    # Assert: éªŒè¯ç»“æœ
    assert response.status_code == 201
    assert response.json['data']['username'] == user.username
```

### 7.3 E2Eæµ‹è¯•æœ€ä½³å®è·µ

**ä½¿ç”¨Page Object Model**ï¼š
```typescript
// âœ… å¥½çš„E2Eæµ‹è¯•ç¤ºä¾‹ï¼ˆä½¿ç”¨POMï¼‰
test('ç”¨æˆ·å¯ä»¥æŒ‰å›½å®¶ç­›é€‰å‘ä»¶ç®±', async ({ page }) => {
  // Arrange
  const loginPage = new LoginPage(page);
  const outboxPage = new OutboxPage(page);

  // Act
  await loginPage.login('e2e_user', 'password');
  await outboxPage.goto();
  await outboxPage.selectCountry('GB');
  await outboxPage.clickQuery();

  // Assert
  await expect(outboxPage.recordCount).toBeGreaterThan(0);
  await outboxPage.verifyAllRecordsHaveCountry('GB');
});

// âŒ ä¸å¥½çš„E2Eæµ‹è¯•ç¤ºä¾‹ï¼ˆç›´æ¥æ“ä½œDOMï¼‰
test('filter test', async ({ page }) => {
  await page.goto('/login');
  await page.fill('#username', 'user');
  await page.fill('#password', 'pass');
  await page.click('button');
  await page.goto('/messages/outbox');
  await page.click('.country-select');
  // ... æµ‹è¯•ä»£ç éš¾ä»¥ç»´æŠ¤
});
```

**ç­‰å¾…ç­–ç•¥**ï¼š
```typescript
// âœ… æ˜¾å¼ç­‰å¾…åŠ è½½å®Œæˆ
await page.waitForSelector('.ant-spin-spinning', { state: 'hidden' });

// âœ… ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆ
await page.waitForResponse(resp => resp.url().includes('/api/v1/sms/outbox'));

// âŒ é¿å…ä½¿ç”¨å›ºå®šå»¶è¿Ÿ
await page.waitForTimeout(3000); // ä¸å¥½
```

**æµ‹è¯•æ•°æ®éš”ç¦»**ï¼š
```typescript
// æ¯ä¸ªæµ‹è¯•ä½¿ç”¨ç‹¬ç«‹çš„æµ‹è¯•æ•°æ®
test.beforeEach(async () => {
  // ä½¿ç”¨å”¯ä¸€æ ‡è¯†åˆ›å»ºæµ‹è¯•æ•°æ®
  testAccountId = `E2E_${Date.now()}`;
});

test.afterEach(async () => {
  // æ¸…ç†æµ‹è¯•æ•°æ®ï¼ˆå¦‚æœéœ€è¦ï¼‰
  await cleanupTestData(testAccountId);
});
```

### 7.4 æµ‹è¯•æ•°æ®ç®¡ç†

**ä½¿ç”¨Factoryæ¨¡å¼ç”Ÿæˆæµ‹è¯•æ•°æ®**ï¼š
```python
# tests/shared/factories/message_factory.py
import factory
from app.models.sms.short_message import ShortMessage
from app.extensions import db

class MessageFactory(factory.alchemy.SQLAlchemyModelFactory):
    class Meta:
        model = ShortMessage
        sqlalchemy_session = db.session

    message_id = factory.Sequence(lambda n: f'TEST_MSG_{n:06d}')
    account_id = 'TEST_ACCOUNT_001'
    status = 'ChannelSendSuccess'
    country_code = 'GB'
    phone_number = factory.Sequence(lambda n: f'4477009{n:05d}')
    content = factory.Faker('text', max_nb_chars=160)
    sender = 'TestSender'
    channel_id = 'TEST_CHANNEL_001'
    send_time = factory.Faker('date_time_this_year')

# ä½¿ç”¨
MessageFactory.create()  # åˆ›å»ºå•ä¸ª
MessageFactory.create_batch(10)  # æ‰¹é‡åˆ›å»º
MessageFactory.create(country_code='US')  # è¦†ç›–é»˜è®¤å€¼
```

### 7.5 é¿å…çš„å¸¸è§é™·é˜±

**âŒ ä¸è¦åœ¨æµ‹è¯•ä¸­ä½¿ç”¨sleep**ï¼š
```python
# ä¸å¥½
def test_something(client):
    client.post('/api/v1/start-job')
    time.sleep(5)  # ç­‰å¾…ä»»åŠ¡å®Œæˆ
    response = client.get('/api/v1/job-status')
    assert response.json['status'] == 'completed'

# å¥½
def test_something(client):
    client.post('/api/v1/start-job')
    # ä½¿ç”¨è½®è¯¢æˆ–äº‹ä»¶æœºåˆ¶
    wait_for_condition(lambda: client.get('/api/v1/job-status').json['status'] == 'completed')
```

**âŒ ä¸è¦åœ¨æµ‹è¯•é—´å…±äº«å¯å˜çŠ¶æ€**ï¼š
```python
# ä¸å¥½
global_test_data = {'user': None}

def test_create_user():
    global_test_data['user'] = create_user()

def test_update_user():  # ä¾èµ–ä¸Šä¸€ä¸ªæµ‹è¯•
    update_user(global_test_data['user'])

# å¥½
@pytest.fixture
def test_user(db_session):
    user = create_user()
    yield user
    # æ¸…ç†ç”±fixtureè‡ªåŠ¨å¤„ç†

def test_update_user(test_user):
    update_user(test_user)
```

**âŒ ä¸è¦è¿‡åº¦mock**ï¼š
```python
# ä¸å¥½ï¼ˆmockå¤ªå¤šï¼Œæµ‹è¯•å¤±å»æ„ä¹‰ï¼‰
@patch('app.services.sms_service.get_account')
@patch('app.services.sms_service.get_channel')
@patch('app.services.sms_service.query_database')
@patch('app.services.sms_service.format_response')
def test_outbox_query(mock1, mock2, mock3, mock4):
    # è¿™ä¸ªæµ‹è¯•å‡ ä¹ä»€ä¹ˆéƒ½æ²¡æµ‹

# å¥½ï¼ˆä»…mockå¤–éƒ¨ä¾èµ–ï¼‰
def test_outbox_query(client, db_session):
    # ä½¿ç”¨çœŸå®æ•°æ®åº“ï¼ˆæµ‹è¯•æ•°æ®åº“ï¼‰ï¼ŒçœŸå®æŸ¥è¯¢
    response = client.get('/api/v1/sms/outbox?...')
    # éªŒè¯çœŸå®çš„ä¸šåŠ¡é€»è¾‘
```

---

## å…«ã€å›¢é˜Ÿåä½œè§„èŒƒ

### 8.1 å¼€å‘æµç¨‹ä¸­çš„æµ‹è¯•è¦æ±‚

**åŠŸèƒ½å¼€å‘æµç¨‹**ï¼š
1. å¼€å‘æ–°åŠŸèƒ½æ—¶ï¼Œå…ˆå†™APIæµ‹è¯•ï¼ˆTDDå¯é€‰ï¼‰
2. å®ç°åŠŸèƒ½ä»£ç 
3. æœ¬åœ°è¿è¡ŒAPIæµ‹è¯•éªŒè¯
4. æ‰‹å·¥æµ‹è¯•éªŒè¯UIå’Œç”¨æˆ·ä½“éªŒ
5. æäº¤ä»£ç å‰è¿è¡Œ `make test-api`
6. æäº¤PRï¼ŒCIè‡ªåŠ¨è¿è¡Œæµ‹è¯•

**Bugä¿®å¤æµç¨‹**ï¼š
1. å…ˆå†™ä¸€ä¸ªå¤±è´¥çš„æµ‹è¯•ï¼Œå¤ç°bug
2. ä¿®å¤ä»£ç ï¼Œä½¿æµ‹è¯•é€šè¿‡
3. å°†æµ‹è¯•æ”¾å…¥ `tests/e2e/tests/regression/` ç›®å½•
4. æµ‹è¯•æ–‡ä»¶å‘½åï¼š`issue-<ç¼–å·>-<ç®€çŸ­æè¿°>.spec.ts`

### 8.2 ä»£ç æäº¤æ£€æŸ¥æ¸…å•

**æäº¤å‰å¿…é¡»**ï¼š
- [ ] æœ¬åœ°è¿è¡Œ `make test-api` é€šè¿‡
- [ ] ç›¸å…³APIæµ‹è¯•å·²æ›´æ–°æˆ–æ–°å¢
- [ ] æ‰‹å·¥æµ‹è¯•éªŒè¯åŠŸèƒ½æ­£å¸¸

**å¯é€‰ï¼ˆé‡å¤§åŠŸèƒ½ï¼‰**ï¼š
- [ ] è¿è¡Œ `make test-smoke` é€šè¿‡
- [ ] æ–°å¢E2Eæµ‹è¯•è¦†ç›–æ–°åŠŸèƒ½

**ä¸è¦æ±‚**ï¼š
- âŒ ä¸è¦æ±‚æ¯æ¬¡æäº¤éƒ½è¿è¡ŒE2Eæµ‹è¯•ï¼ˆå¤ªæ…¢ï¼‰
- âŒ ä¸è¦æ±‚100%æµ‹è¯•è¦†ç›–ç‡ï¼ˆåŠ¡å®å³å¯ï¼‰

### 8.3 æµ‹è¯•å¤±è´¥çš„å¤„ç†

**APIæµ‹è¯•å¤±è´¥**ï¼š
- ç«‹å³ä¿®å¤ï¼ˆä¸å…è®¸æäº¤å¤±è´¥çš„æµ‹è¯•ï¼‰
- å¦‚æœæµ‹è¯•æœ¬èº«æœ‰é—®é¢˜ï¼Œä¿®å¤æµ‹è¯•

**E2Eæµ‹è¯•å¤±è´¥**ï¼š
- åŒºåˆ†æ˜¯çœŸbugè¿˜æ˜¯flaky test
- å¦‚æœæ˜¯flaky testï¼Œæ ‡è®° `test.fixme()` æˆ–å¢åŠ é‡è¯•
- å¦‚æœæ˜¯çœŸbugï¼Œä¿®å¤å¹¶æ›´æ–°æµ‹è¯•

**å¤„ç†flaky E2Eæµ‹è¯•**ï¼š
```typescript
// ä¸´æ—¶è·³è¿‡ä¸ç¨³å®šçš„æµ‹è¯•
test.fixme('è¿™ä¸ªæµ‹è¯•ä¸ç¨³å®šï¼Œéœ€è¦ä¼˜åŒ–', async ({ page }) => {
  // test code
});

// æˆ–è€…å¢åŠ é‡è¯•æ¬¡æ•°
test.describe.configure({ retries: 2 });
```

### 8.4 æµ‹è¯•ä»£ç çš„Code Reviewè¦æ±‚

**APIæµ‹è¯•Reviewè¦ç‚¹**ï¼š
- [ ] æµ‹è¯•åç§°æ¸…æ™°æè¿°æµ‹è¯•å†…å®¹
- [ ] æµ‹è¯•ç‹¬ç«‹ï¼Œä¸ä¾èµ–å…¶ä»–æµ‹è¯•
- [ ] ä½¿ç”¨Factoryåˆ›å»ºæµ‹è¯•æ•°æ®ï¼Œä¸hardcode
- [ ] éªŒè¯å……åˆ†ï¼ˆä¸ä»…æ˜¯200çŠ¶æ€ç ï¼Œè¿˜è¦éªŒè¯æ•°æ®æ­£ç¡®æ€§ï¼‰
- [ ] éµå¾ªAAAæ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰

**E2Eæµ‹è¯•Reviewè¦ç‚¹**ï¼š
- [ ] ä½¿ç”¨Page Object Model
- [ ] é¿å…ä½¿ç”¨sleepï¼Œä½¿ç”¨æ˜¾å¼ç­‰å¾…
- [ ] æµ‹è¯•èšç„¦å…³é”®è·¯å¾„ï¼Œä¸è¿½æ±‚ç»†èŠ‚
- [ ] å¤±è´¥æ—¶æˆªå›¾å’Œtraceæ¸…æ™°

---

## ä¹ã€è¿ç§»è®¡åˆ’

### 9.1 ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€æ­å»ºï¼ˆ1å‘¨ï¼‰

**ç›®æ ‡**ï¼šæ­å»ºæµ‹è¯•æ¡†æ¶ï¼Œè¿ç§»ç°æœ‰æµ‹è¯•

**ä»»åŠ¡**ï¼š
1. åˆ›å»º `tests/` ç›®å½•ç»“æ„
2. é…ç½®pytestå’ŒPlaywright
3. è¿ç§»ç°æœ‰çš„åç«¯æµ‹è¯•åˆ°æ–°ç›®å½•
4. ç¼–å†™1-2ä¸ªAPIæµ‹è¯•ç¤ºä¾‹
5. ç¼–å†™1ä¸ªE2Eæµ‹è¯•ç¤ºä¾‹
6. é…ç½®Makefileå‘½ä»¤

**éªŒæ”¶æ ‡å‡†**ï¼š
- `make test-api` å¯ä»¥è¿è¡Œ
- `make test-e2e` å¯ä»¥è¿è¡ŒE2Eç¯å¢ƒ

### 9.2 ç¬¬äºŒé˜¶æ®µï¼šAPIæµ‹è¯•è¦†ç›–ï¼ˆ2-3å‘¨ï¼‰

**ç›®æ ‡**ï¼šè¦†ç›–æ ¸å¿ƒAPIç«¯ç‚¹

**ä»»åŠ¡**ï¼š
1. å‘ä»¶ç®±APIæµ‹è¯•ï¼ˆæŸ¥è¯¢ã€ç­›é€‰ã€åˆ†é¡µã€å¯¼å‡ºã€è¯¦æƒ…ï¼‰
2. æ”¶ä»¶ç®±APIæµ‹è¯•ï¼ˆæŸ¥è¯¢ã€ç­›é€‰ã€è¯¦æƒ…ï¼‰
3. è´¦å·ç®¡ç†APIæµ‹è¯•ï¼ˆCRUDã€åˆ—è¡¨ï¼‰
4. é€šé“ç®¡ç†APIæµ‹è¯•ï¼ˆCRUDã€å‘Šè­¦ã€çŠ¶æ€ï¼‰
5. è®¤è¯APIæµ‹è¯•ï¼ˆç™»å½•ã€æƒé™ã€Tokenï¼‰

**ç›®æ ‡è¦†ç›–ç‡**ï¼š70%+ APIç«¯ç‚¹

### 9.3 ç¬¬ä¸‰é˜¶æ®µï¼šE2Eæµ‹è¯•è¡¥å……ï¼ˆ1-2å‘¨ï¼‰

**ç›®æ ‡**ï¼šè¦†ç›–å…³é”®ç”¨æˆ·è·¯å¾„

**ä»»åŠ¡**ï¼š
1. ç¼–å†™5-10ä¸ªå…³é”®E2Eæµ‹è¯•
2. é…ç½®Dockerç¯å¢ƒ
3. ä¼˜åŒ–E2Eæµ‹è¯•ç¨³å®šæ€§
4. é…ç½®CIé›†æˆ

**å…³é”®åœºæ™¯**ï¼š
- ç™»å½• â†’ æŸ¥çœ‹å‘ä»¶ç®± â†’ ç­›é€‰ â†’ è¯¦æƒ…
- ç™»å½• â†’ æŸ¥çœ‹æ”¶ä»¶ç®± â†’ å¯¼å‡º
- ç®¡ç†å‘˜ â†’ åˆ›å»ºè´¦å· â†’ é…ç½®é€šé“
- ç®¡ç†å‘˜ â†’ æŸ¥çœ‹ç»Ÿè®¡æŠ¥è¡¨

### 9.4 ç¬¬å››é˜¶æ®µï¼šæŒç»­ä¼˜åŒ–ï¼ˆé•¿æœŸï¼‰

**ç›®æ ‡**ï¼šç»´æŠ¤å’Œä¼˜åŒ–æµ‹è¯•å¥—ä»¶

**ä»»åŠ¡**ï¼š
1. å®šæœŸReviewæµ‹è¯•è¦†ç›–ç‡
2. æ¸…ç†è¿‡æ—¶çš„å•å…ƒæµ‹è¯•
3. ä¼˜åŒ–E2Eæµ‹è¯•é€Ÿåº¦
4. å¤„ç†flaky tests
5. æ›´æ–°æµ‹è¯•æ–‡æ¡£

---

## åã€é™„å½•

### 10.1 æŠ€æœ¯æ ˆ

**åç«¯æµ‹è¯•**ï¼š
- pytest 7.4+
- pytest-covï¼ˆè¦†ç›–ç‡ï¼‰
- factory_boyï¼ˆæµ‹è¯•æ•°æ®å·¥å‚ï¼‰
- SQLAlchemyï¼ˆORMï¼‰

**å‰ç«¯æµ‹è¯•**ï¼š
- Playwrightï¼ˆE2Eæµ‹è¯•ï¼‰
- vitestï¼ˆå•å…ƒæµ‹è¯•ï¼Œå¯é€‰ï¼‰

**åŸºç¡€è®¾æ–½**ï¼š
- Docker & Docker Compose
- PostgreSQL 16
- GitHub Actions

### 10.2 å‚è€ƒèµ„æ–™

- [Playwrightå®˜æ–¹æ–‡æ¡£](https://playwright.dev/)
- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [Testing Best Practices](https://martinfowler.com/testing/)
- [Page Object Model](https://playwright.dev/docs/pom)

### 10.3 å¸¸è§é—®é¢˜FAQ

**Q1: ä¸ºä»€ä¹ˆè¦æ”¾å¼ƒå¤§éƒ¨åˆ†å•å…ƒæµ‹è¯•ï¼Ÿ**
A: åœ¨AIè¾…åŠ©å¼€å‘åœºæ™¯ä¸‹ï¼Œä»£ç é‡æ„é¢‘ç¹ï¼Œå•å…ƒæµ‹è¯•ç»´æŠ¤æˆæœ¬é«˜ã€‚APIæµ‹è¯•å’ŒE2Eæµ‹è¯•éªŒè¯è¡Œä¸ºè€Œéå®ç°ï¼Œæ›´ç¨³å®šã€‚

**Q2: E2Eæµ‹è¯•ä¼šä¸ä¼šå¾ˆæ…¢ï¼Ÿ**
A: æ˜¯çš„ï¼Œä½†æˆ‘ä»¬åªè¿è¡Œå…³é”®çš„5-10ä¸ªE2Eæµ‹è¯•ï¼Œæ§åˆ¶åœ¨10-20åˆ†é’Ÿå†…ã€‚æ—¥å¸¸å¼€å‘ä¸»è¦ä¾èµ–å¿«é€Ÿçš„APIæµ‹è¯•ã€‚

**Q3: æœ¬åœ°å¼€å‘æ—¶å¿…é¡»è¿è¡ŒE2Eæµ‹è¯•å—ï¼Ÿ**
A: ä¸éœ€è¦ã€‚æ—¥å¸¸å¼€å‘åªéœ€è¿è¡ŒAPIæµ‹è¯•ï¼ˆç§’çº§ï¼‰ã€‚E2Eæµ‹è¯•åœ¨é‡å¤§åŠŸèƒ½ä¸Šçº¿å‰æˆ–CIç¯å¢ƒè¿è¡Œã€‚

**Q4: æµ‹è¯•ç¯å¢ƒä¼šä¸ä¼šå’Œå¼€å‘ç¯å¢ƒå†²çªï¼Ÿ**
A: ä¸ä¼šã€‚E2Eæµ‹è¯•ä½¿ç”¨å®Œå…¨ç‹¬ç«‹çš„Dockerç¯å¢ƒï¼Œä¸åŒçš„ç«¯å£å’Œæ•°æ®åº“ã€‚

**Q5: APIæµ‹è¯•éœ€è¦æ‰‹åŠ¨å‡†å¤‡æ•°æ®å—ï¼Ÿ**
A: ä¸éœ€è¦ã€‚ä½¿ç”¨factory_boyè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•æ•°æ®ï¼Œæ¯ä¸ªæµ‹è¯•ç‹¬ç«‹åˆ›å»ºå’Œæ¸…ç†ã€‚

**Q6: å¦‚ä½•å¤„ç†flaky E2Eæµ‹è¯•ï¼Ÿ**
A:
1. ä¼˜åŒ–ç­‰å¾…ç­–ç•¥ï¼ˆé¿å…sleepï¼‰
2. å¢åŠ é‡è¯•æ¬¡æ•°
3. å¦‚æœä»ä¸ç¨³å®šï¼Œæ ‡è®°ä¸º `test.fixme()` å¹¶åˆ›å»ºissueè·Ÿè¸ª

**Q7: CIç¯å¢ƒæµ‹è¯•å¤±è´¥äº†æ€ä¹ˆåŠï¼Ÿ**
A:
1. æŸ¥çœ‹GitHub Actionsçš„æµ‹è¯•æŠ¥å‘Š
2. ä¸‹è½½Playwrightçš„æˆªå›¾å’Œtrace
3. æœ¬åœ°å¤ç°ï¼š`make e2e-up && cd tests/e2e && npx playwright test --debug`

---

## åä¸€ã€æ€»ç»“

æœ¬æµ‹è¯•æ–¹æ¡ˆçš„æ ¸å¿ƒç†å¿µï¼š

1. **é€‚åº”AIå¼€å‘** - å‡å°‘è„†å¼±çš„å•å…ƒæµ‹è¯•ï¼Œå¢åŠ ç¨³å®šçš„è¡Œä¸ºæµ‹è¯•
2. **åŠ¡å®é«˜æ•ˆ** - æŠ•å…¥äº§å‡ºæ¯”é«˜ï¼Œ60% API + 30% E2E + 10% Unit
3. **ç¯å¢ƒéš”ç¦»** - E2Eæµ‹è¯•å®Œå…¨ç‹¬ç«‹ï¼Œä¸å¹²æ‰°æ—¥å¸¸å¼€å‘
4. **å¿«é€Ÿåé¦ˆ** - æ—¥å¸¸ä¾èµ–å¿«é€Ÿçš„APIæµ‹è¯•ï¼ŒCIä¿è¯å®Œæ•´è´¨é‡
5. **æŒç»­ä¼˜åŒ–** - æµ‹è¯•ä¹Ÿæ˜¯ä»£ç ï¼Œéœ€è¦ä¸æ–­ç»´æŠ¤å’Œæ”¹è¿›

**é¢„æœŸæ”¶ç›Š**ï¼š
- âœ… ä»£ç è´¨é‡æœ‰ä¿éšœï¼ˆAPI+E2Eè¦†ç›–ï¼‰
- âœ… å¼€å‘æ•ˆç‡ä¸å—å½±å“ï¼ˆæµ‹è¯•ç¯å¢ƒéš”ç¦»ï¼‰
- âœ… ç»´æŠ¤æˆæœ¬ä½ï¼ˆå°‘é‡å•å…ƒæµ‹è¯•ï¼‰
- âœ… CIå¿«é€Ÿåé¦ˆï¼ˆAPIæµ‹è¯•ç§’çº§ï¼ŒE2Eåˆ†é’Ÿçº§ï¼‰
- âœ… å›¢é˜Ÿä¿¡å¿ƒæå‡ï¼ˆå…³é”®æµç¨‹æœ‰E2Eä¿éšœï¼‰

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**ï¼š
1. å›¢é˜ŸReviewæœ¬æ–‡æ¡£ï¼Œè®¨è®ºå¹¶è¾¾æˆå…±è¯†
2. æŒ‰ç…§è¿ç§»è®¡åˆ’é€æ­¥å®æ–½
3. æŒç»­è¿­ä»£ä¼˜åŒ–æµ‹è¯•ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬å†å²**ï¼š
- v1.0 (2025-10-11): åˆå§‹ç‰ˆæœ¬ï¼Œå¾…å›¢é˜ŸReview
