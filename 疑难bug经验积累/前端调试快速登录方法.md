# 前端调试快速登录方法

**日期**: 2025-10-23
**作者**: yukun.xing

## 问题场景

在调试前端页面时，经常需要测试需要登录才能访问的页面功能。每次都要：
1. 查找测试用户名和密码
2. 手动连接数据库查询用户
3. 尝试各种方式获取token

这个过程非常耗时，经常需要10-15分钟才能完成登录。

## 快速解决方案

### 1. 测试环境配置信息

**手动测试使用的数据库（E2E环境）**:
- 数据库地址: `localhost:5433`
- 数据库名: `pigeon_sms_e2e`
- 用户名: `yuexin`
- 密码: `test_password`
- Schema: `mgmt`

**后端API地址**:
- 开发环境: `http://localhost:5000/api/v1`

### 2. 测试账号信息

所有测试账号的统一密码是: **`admin123`**

常用测试账号：
- `dept_manager1` - 部门管理员（admin角色）
- `dept_manager2` - 部门管理员（admin角色）
- `admin` - 超级管理员（super_admin角色）

密码记录位置：
```
pigeon_web/sql/mock_data/admin_rbac.sql
第136行：-- Note: password for all users is 'admin123'
```

### 3. 快速登录步骤

**方法1: 直接通过浏览器登录**
1. 访问 `http://localhost:5173/login`
2. 输入用户名: `dept_manager1`
3. 输入密码: `admin123`
4. 点击登录

**方法2: 通过API获取token（用于API测试）**
```bash
# 获取token
curl -X POST http://localhost:5000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username": "dept_manager1", "password": "admin123"}'

# 使用token调用API
TOKEN="<从上面返回的access_token>"
curl -X GET "http://localhost:5000/api/v1/blacklists/" \
  -H "Authorization: Bearer $TOKEN"
```

### 4. 数据库快速查询

**查看测试数据**:
```bash
# 连接数据库
PGPASSWORD=test_password psql -h localhost -p 5433 -U yuexin -d pigeon_sms_e2e

# 查看admin用户
SELECT id, username, is_active FROM mgmt.admin_users LIMIT 5;

# 查看黑名单数据
SELECT id, name, status FROM mgmt.blacklists LIMIT 5;
```

## 经验教训

1. **不要盲目尝试连接不同的数据库端口** - 先确认项目使用的数据库配置
2. **优先查看SQL mock数据文件** - 测试用户的密码通常在 `sql/mock_data/` 目录的注释中
3. **记住统一的测试密码** - 当前项目所有测试账号密码都是 `admin123`
4. **使用浏览器登录最简单** - 不需要手动处理token，直接在页面操作即可

## 下次遇到类似问题时

1. 直接打开 `http://localhost:5173/login`
2. 使用 `dept_manager1` / `admin123` 登录
3. 如果需要API token，用上面的curl命令快速获取

**预计时间**: 从10-15分钟缩短到 **30秒以内**
