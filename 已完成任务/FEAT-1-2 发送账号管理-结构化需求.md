# 发送账号管理 - 结构化需求文档

## 业务实体定义

这个页面是关于**发送账号**业务实体的管理。发送账号是SMS平台中用于客户发送短信的核心账号实体，每个发送账号具有独立的配置、权限和计费规则。

## 业务实体关系

### 发送账号与其他业务实体的关系

#### 核心关系图
```
                    管理员(1:N)
                      ↑
                      |
企业账号(N:1) ← 发送账号 → 通道组(M:N)
                      ↓
                 账号控制规则(1:1)
                      ↓
              ┌─────────────────┐
              ↓                 ↓
          黑名单库(M:N)    敏感词库(M:N)
              ↓                 ↓
          号码拦截          内容审核
```

#### 详细关系说明

**1. 发送账号 ← 管理员（一对多关系）**
- 关系描述：每个发送账号必须归属于一个管理员，一个管理员可以管理多个发送账号
- 业务含义：明确管理责任，实现权限控制和操作审计
- 约束条件：发送账号创建时必须指定归属管理员，不允许无归属的发送账号存在

**2. 发送账号 ← 企业账号（多对一关系）**
- 关系描述：多个发送账号可以属于同一个企业账号，但一个发送账号只能属于一个企业账号
- 业务含义：企业级的账号组织管理，支持企业多账号策略
- 约束条件：不允许一个发送账号属于多个企业账号，企业账号删除时需要处理其下属的发送账号

**3. 发送账号 ↔ 通道组（多对多关系）**
- 关系描述：一个发送账号可以配置多个通道组，一个通道组可以被多个发送账号使用
- 业务含义：灵活的路由策略，支持负载均衡、故障转移和成本优化
- 约束条件：发送账号至少需要配置一个可用通道组才能正常发送短信

**4. 发送账号 ↔ 账号控制规则（一对一关系）**
- 关系描述：每个发送账号对应一套独立的控制规则配置
- 业务含义：个性化的风控策略，支持不同账号的差异化管控需求
- 约束条件：发送账号创建时自动创建默认控制规则，账号删除时同步删除规则

**5. 发送账号 ↔ Sender配置（一对多关系）**
- 关系描述：一个发送账号可以配置多个Sender标识（全局+按国家）
- 业务含义：满足不同国家地区的合规要求和品牌展示需求
- 约束条件：Sender标识在全平台范围内必须唯一，支持全局和国家特定配置

**6. 发送账号 ↔ 黑名单库（多对多关系，通过控制规则）**
- 关系描述：发送账号通过控制规则配置可以关联多个黑名单库，黑名单库可被多个账号使用
- 业务含义：灵活的号码拦截策略，支持共享和独立的黑名单管理
- 约束条件：黑名单库删除前需要检查关联的发送账号控制规则

**7. 发送账号 ↔ 敏感词库（多对多关系，通过控制规则）**
- 关系描述：发送账号通过控制规则可以配置多个敏感词库，敏感词库可被多个账号使用
- 业务含义：灵活的内容审核策略，支持不同行业和场景的敏感词控制
- 约束条件：敏感词库删除前需要检查关联的发送账号控制规则

#### 数据一致性要求

**强一致性要求：**
- 发送账号删除时必须同步删除对应的账号控制规则
- 发送账号归属管理员变更时需要验证新管理员的权限
- 企业账号删除时需要先处理其下属的所有发送账号

**最终一致性要求：**
- 通道组配置变更后，相关发送账号的路由策略可能需要一定时间生效
- 黑名单和敏感词库更新后，规则生效允许一定延迟

#### 级联操作规则

**删除级联：**
- 删除管理员前需要重新分配其管理的发送账号
- 删除企业账号前需要处理其下属的发送账号
- 删除发送账号时自动删除其控制规则和Sender配置

**修改级联：**
- 管理员权限变更可能影响其管理的发送账号的操作权限
- 通道组状态变更会影响使用该通道组的所有发送账号

## 发送账号属性定义

发送账号一共有如下属性：

| 属性名称 | 属性类型 | 说明 | 枚举值/格式 |
|---------|---------|------|-----------|
| 发送账号 | 文本 | 系统自动生成的唯一标识 | 6位字母+数字组合，如：ySEmvr |
| 账号名称 | 文本 | 账号的显示名称 | 用户自定义文本 |
| 金额/余付 | 数值 | 账号余额或付费金额 | 数值类型，支持小数 |
| 协议 | 枚举 | 使用的通信协议类型 | SMPP、HTTP、CMPP |
| 状态 | 枚举 | 账号启用状态 | 开启、关闭 |
| 通道组 | 文本 | 关联的通道组名称 | 通道组名称文本 |
| 归属 | 文本 | 账号归属管理员 | 管理员姓名 |
| 企业账号 | 文本 | 关联的企业账号 | 企业账号名称 |
| 付费类型 | 枚举 | 付费模式 | 预付款、后付款 |
| 创建时间 | 日期时间 | 账号创建时间 | YYYY-MM-DD HH:mm:ss |
| 最后修改时间 | 日期时间 | 账号最后修改时间 | YYYY-MM-DD HH:mm:ss |
| sender | 文本 | 发送方标识 | 支持全局和按国家配置 |
| 登录密码 | 文本 | 账号登录密码 | 6位字母+数字组合 |
| 备注 | 文本 | 账号描述信息 | 用户自定义文本 |
| 账单计算 | 枚举 | 计费方式 | 提交计费 |
| IP白名单 | 文本 | 允许访问的IP地址列表 | IP地址，多个用英文逗号分隔 |
| 接口密码 | 文本 | API调用密码 | 6位字母+数字组合 |
| 最大连接数 | 数值 | 最大并发连接数 | 默认1 |
| 最大速度 | 数值 | 最大发送速度（条/秒） | 默认200 |
| 限速 | 布尔 | 是否启用速度限制 | 是、否 |
| 沉默天数 | 数值 | 账号沉默状态天数 | 数值 |
| 网关IP | 文本 | 网关服务器IP地址 | IP地址格式 |
| 网关端口 | 数值 | 网关服务端口号 | 端口号 |
| 补发策略 | 枚举 | 失败消息补发策略 | 不补发、补发 |
| 补发类型 | 枚举 | 补发具体类型 | 失败全补发、按照错误码补发 |
| 补发超时时间 | 数值 | 补发时间限制（秒） | 数值 |
| 补发错误码 | 文本 | 需要补发的错误码列表 | 错误码，多个用逗号分隔 |
| 脱敏策略 | 枚举 | 数据脱敏规则 | 不脱敏、号码脱敏等 |
| 全局Sender | 文本 | 全局发送方标识 | 全局适用的sender标识 |
| 国家特定Sender | 对象数组 | 按国家配置的sender | 包含国家代码和sender标识 |
| 余额查询地址 | 文本 | 查询账户余额的API地址 | URL格式 |
| 客户端地址 | 文本 | 客户端访问地址 | URL格式 |
| 客户端登录账号 | 文本 | 客户端登录使用的账号 | 用户名格式 |
| 客户端登录密码 | 文本 | 客户端登录使用的密码 | 密码格式 |
| 控制规则配置 | 对象 | 账号控制规则设置 | 包含各种风控规则 |
| 通道组配置 | 对象数组 | 通道组关联配置 | 包含通道组信息和权重等 |

## 列表页面显示

在列表里，我希望显示以下属性：
- 序号
- 发送账号/名称（组合显示：发送账号标识 + 账号名称）
- 金额/余付
- 协议
- 状态
- 通道组
- 归属

## 查询筛选条件

我希望能按照以下属性进行查询：
- **管理员筛选**：下拉选择筛选（归属）
- **企业账号筛选**：下拉选择筛选
- **状态筛选**：下拉选择筛选（开启/关闭）
- **付费类型筛选**：下拉选择筛选（预付款/后付款）
- **发送账号/名称查询**：模糊查询（发送账号、账号名称）

## 列表项操作

对列表中的每一个item，我需要对它进行的操作包括：

### 主要操作

#### 1. 修改操作
**操作说明**：打开编辑表单，允许修改发送账号的所有可编辑属性
**涉及属性**：
- **基本设置**：账号归属、账号名称、备注、登录密码、状态、账单计算、付费类型、IP白名单
- **协议设置**：协议类型、接口密码、最大连接数、最大速度、限速
- **Sender配置**：全局Sender、国家特定Sender（包括添加、删除、修改）
- **更多设置**：补发策略、补发类型、补发超时时间、补发错误码、脱敏策略
- **注意**：发送账号标识不可修改（系统生成的唯一标识）

#### 2. 概览操作
**操作说明**：弹窗查看发送账号的详细信息，只读模式，不允许修改
**涉及属性**：
- **基本信息模块**：发送账号、账号名称、sender、付款类型、创建时间、沉默天数、IP白名单
- **协议信息模块**：协议类型、网关IP、网关端口、账号、密码、总连接数、总速度、余额查询地址（暂时隐藏）
- **客户端信息模块（暂时隐藏）**：客户端地址、登录账号、登录密码
- **复制功能**：在协议信息和客户端信息模块提供复制按钮

#### 3. 配置通道组操作
**操作说明**：弹窗管理发送账号与通道组的关联关系
**涉及属性**：
- **通道组配置**：当前关联的通道组列表、通道组类型、通道组标识、通道组名称
- **操作功能**：
  - 切换通道组：修改通道组关联关系
  - 删除通道组配置：移除特定通道组关联
  - 查看通道组详情：查看选中通道组的详细信息

### 更多操作（下拉菜单）

#### 4. 账号控制规则操作
**操作说明**：配置发送账号的风控规则和校验策略
**涉及属性**：
- **控制规则配置**：号码验证规则、批量限制规则、国家校验规则、黑名单规则、时间段拦截规则等
- **规则参数**：各种规则的具体参数配置
- **规则状态**：启用/禁用各项控制规则

#### 5. 发送短信操作（暂时隐藏）
**操作说明**：测试发送短信功能
**涉及属性**：
- **测试相关**：测试号码、测试内容、发送结果

#### 6. 控制设置操作
**操作说明**：账号控制相关的高级设置
**涉及属性**：
- **控制策略**：各种控制策略的开关和参数
- **限制规则**：发送限制、频率控制等规则

#### 7. 删除操作
**操作说明**：删除发送账号（需要权限验证和二次确认）
**涉及属性**：
- **删除检查**：检查关联的未完成任务、通道组配置、历史记录等
- **删除确认**：需要用户输入确认文本进行二次确认

#### 8. 登录操作（暂时隐藏）
**操作说明**：使用该发送账号进行登录
**涉及属性**：
- **登录凭据**：发送账号、登录密码

#### 9. 客户端权限操作（暂时隐藏）
**操作说明**：管理客户端访问权限
**涉及属性**：
- **权限配置**：客户端访问权限、功能权限等

### 批量操作

#### 10. 批量删除操作
**操作说明**：选择多个发送账号进行批量删除
**涉及属性**：
- **选择状态**：通过复选框选择的账号列表
- **删除确认**：批量删除的二次确认
- **关联检查**：批量检查所有选中账号的关联数据

#### 11. 批量修改归属管理员操作
**操作说明**：批量修改选中账号的归属管理员
**涉及属性**：
- **归属**：所有选中账号的归属管理员属性
- **目标管理员**：要修改为的目标管理员

#### 12. 导出操作
**操作说明**：导出账号列表数据（支持全部导出和选择性导出）
**涉及属性**：
- **导出字段**：发送账号、账号名称、金额/余付、协议、状态、通道组、归属、企业账号、付费类型、创建时间、最后修改时间
- **导出范围**：根据选择状态确定导出全部还是选中的账号

## 查看（概览）时显示的属性

查看的时候，我希望查看以下属性，按模块分组展示：

### 基本信息模块
- 发送账号
- 账号名称
- sender
- 付款类型
- 创建时间
- 沉默天数
- IP白名单

### 协议信息模块
- 协议类型
- 网关IP
- 网关端口
- 账号
- 密码
- 总连接数
- 总速度
- 余额查询地址（暂时隐藏）

### 客户端信息模块（暂时隐藏）
- 客户端地址
- 登录账号
- 登录密码

## 新建/修改时的操作步骤

修改（以及新建）的时候，我希望通过4个步骤：

### 第一步：基本设置
我要配置它的以下属性：
- 账号归属（必填）
- 发送账号（系统自动生成）
- 账号名称（必填）
- 备注
- 登录密码（系统自动生成，可手动修改）
- 账号状态
- 账单计算
- 付款类型
- IP白名单

### 第二步：协议设置
我要配置它的以下属性：
- 协议类型（必填，目前仅支持SMPP）
- 接口密码（系统自动生成，可手动修改）
- 最大连接数（默认1）
- 最大速度（默认200）
- 限速（默认启用）

### 第三步：Sender配置
我要配置它的以下属性：
- 全局Sender（适用于所有国家的默认发送方标识）
- 国家特定Sender（可添加多个国家的专用sender标识）
- Sender唯一性校验（系统自动检查重复性）

### 第四步：更多设置
我要配置它的以下属性：
- 补发策略相关：
  - 补发模式（不补发/补发）
  - 补发类型（失败全补发/按照错误码补发）
  - 错误码配置（按错误码补发时需要）
  - 补发超时时间
- 脱敏策略
- 是否追加内容（暂时隐藏）
- 是否平台加签名（暂时隐藏）
- 错误码转换（暂时隐藏）
- 错误码加黑（暂时隐藏）
- 短信认证（暂时隐藏）

## 特殊业务规则

### 自动生成规则
- **发送账号**：系统自动生成6位字母+数字的随机组合
- **登录密码**：系统自动生成6位字母+数字的随机组合
- **接口密码**：系统自动生成6位字母+数字的随机组合

### 唯一性校验
- **Sender标识**：全局唯一，系统需要检查重复性并阻止保存重复的sender

### 权限控制
- **删除操作**：需要高级管理员权限
- **批量操作**：需要相应的管理权限
- **导出操作**：需要授权用户权限

### 数据关联处理
- **删除前检查**：检查未完成的短信任务、通道组配置、历史记录等
- **通道组配置**：支持多通道组关联和切换
- **管理员归属**：支持批量修改归属关系

## 导出功能特殊说明

### 智能导出模式
- **默认导出模式**：未勾选任何账号时，导出所有发送账号信息
- **选择导出模式**：勾选特定账号后，仅导出选中的发送账号信息

### 导出字段
按顺序包含：发送账号、账号名称、金额/余付、协议、状态、通道组、归属、企业账号、付费类型、创建时间、最后修改时间

### 文件格式
- 标准Excel格式(.xlsx)
- 文件命名："发送账号_时间戳.xlsx"
- 支持最多5000个账号的导出