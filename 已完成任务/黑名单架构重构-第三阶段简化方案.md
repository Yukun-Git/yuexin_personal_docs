# Copyright(c) 2025
# All rights reserved.
#
# Author: yukun.xing <xingyukun@gmail.com>
# Date:   2025/01/12

# é»‘åå•æ¶æ„é‡æ„ - ç¬¬ä¸‰é˜¶æ®µç®€åŒ–æ–¹æ¡ˆ

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

**é˜¶æ®µåç§°**: ç¬¬ä¸‰é˜¶æ®µï¼šå‰ç«¯ç•Œé¢é‡æ„ (ç®€åŒ–ç‰ˆ)  
**å‰ç½®æ¡ä»¶**: âœ… æ•°æ®åº“é‡æ„å®Œæˆï¼Œâœ… åç«¯APIé‡æ„å®Œæˆ  
**æ ¸å¿ƒç›®æ ‡**: åŠŸèƒ½å®Œæ•´ï¼ŒæŠ€æœ¯ç¨³å®šï¼Œå¿«é€Ÿäº¤ä»˜  
**è®¾è®¡åŸåˆ™**: **ä¿å®ˆå®ç”¨ï¼Œé¿å…è¿‡åº¦è®¾è®¡**  
**é¢„è®¡å·¥æœŸ**: **6-8å°æ—¶** / 1ä¸ªå·¥ä½œæ—¥ âœ…

## ğŸ¯ **ç°å®éœ€æ±‚è¯„ä¼°**

### **å®é™…æ•°æ®é‡** (ä¸æ˜¯åƒä¸‡çº§!)
- **é»‘åå•æ•°é‡**: 5-20ä¸ªé»‘åå•é›†åˆ
- **æ‰‹æœºå·æ•°é‡**: æ¯ä¸ªé»‘åå• **1000-20000æ¡** æ‰‹æœºå·
- **æ‰¹é‡æ“ä½œ**: ä¸€æ¬¡æ“ä½œ **å‡ ç™¾åˆ°å‡ åƒæ¡** (ä¸æ˜¯10ä¸‡+)
- **æ–‡ä»¶å¯¼å…¥**: **å‡ åKBåˆ°å‡ MB** (ä¸æ˜¯å‡ ç™¾MB)
- **ç”¨æˆ·åœºæ™¯**: ç®¡ç†å‘˜å¶å°”æ‰¹é‡å¯¼å…¥ï¼Œæ—¥å¸¸å•ä¸ªæ“ä½œ

### **æŠ€æœ¯é€‰å‹åŸåˆ™**
- âœ… **æˆç†Ÿç¨³å®š**: ä½¿ç”¨Ant Designæ ‡å‡†ç»„ä»¶
- âœ… **ç®€å•ç›´æ¥**: ä¸å¼•å…¥å¤æ‚æŠ€æœ¯æ ˆ
- âœ… **å¤Ÿç”¨å³å¯**: æ»¡è¶³å½“å‰éœ€æ±‚ï¼Œä¸è¿‡åº¦ä¼˜åŒ–
- âœ… **å¯ç»´æŠ¤**: ä»£ç ç®€æ´ï¼Œä¾¿äºåç»­ç»´æŠ¤
- âœ… **æ¸è¿›å¼**: æœªæ¥éœ€è¦æ—¶å†å‡çº§

## ğŸ› ï¸ **æŠ€æœ¯æ–¹æ¡ˆè®¾è®¡**

### **1. åˆ—è¡¨æ˜¾ç¤º - æ ‡å‡†åˆ†é¡µè¡¨æ ¼**

```typescript
// ä½¿ç”¨ Ant Design Tableï¼Œä¸éœ€è¦è™šæ‹Ÿæ»šåŠ¨
const PhoneTable: React.FC = () => {
  const [pagination, setPagination] = useState({
    current: 1,
    pageSize: 50,  // æ¯é¡µ50æ¡ï¼Œå®Œå…¨å¤Ÿç”¨
    total: 0
  });

  const { data, isLoading } = useGetPhonesQuery({
    blacklistId,
    page: pagination.current,
    per_page: pagination.pageSize,
    search: searchQuery
  });

  return (
    <Table
      dataSource={data?.data || []}
      columns={phoneColumns}
      pagination={{
        ...pagination,
        total: data?.meta?.total,
        showSizeChanger: true,
        showQuickJumper: true,
        showTotal: (total) => `å…± ${total.toLocaleString()} æ¡`,
        onChange: (page, pageSize) => {
          setPagination({ current: page, pageSize, total: pagination.total });
        }
      }}
      rowSelection={{
        selectedRowKeys,
        onChange: setSelectedRowKeys,
        getCheckboxProps: (record) => ({
          disabled: record.status === 'PROCESSING'
        })
      }}
      loading={isLoading}
      size="small"
      scroll={{ y: 400 }}
    />
  );
};
```

**ä¼˜åŠ¿**:
- âœ… **é›¶é£é™©**: Ant Design Table 100%ç¨³å®š
- âœ… **ç”¨æˆ·ç†Ÿæ‚‰**: æ ‡å‡†åˆ†é¡µç•Œé¢ï¼Œå­¦ä¹ æˆæœ¬é›¶
- âœ… **æ€§èƒ½å¤Ÿç”¨**: 50æ¡/é¡µï¼ŒåŠ è½½å’Œæ¸²æŸ“éƒ½å¾ˆå¿«
- âœ… **åŠŸèƒ½å®Œæ•´**: æœç´¢ã€æ’åºã€ç­›é€‰ã€é€‰æ‹©éƒ½æ”¯æŒ

### **2. æ‰¹é‡æ“ä½œ - é¡µé¢çº§é€‰æ‹©**

```typescript
// ç®€å•çš„æ‰¹é‡é€‰æ‹©ï¼ŒåŸºäºå½“å‰é¡µé¢
const useBatchSelection = () => {
  const [selectedRowKeys, setSelectedRowKeys] = useState<string[]>([]);
  
  const handleBatchOperation = async (operation: string) => {
    if (selectedRowKeys.length === 0) {
      message.warning('è¯·å…ˆé€‰æ‹©è¦æ“ä½œçš„æ‰‹æœºå·');
      return;
    }

    try {
      setLoading(true);
      switch (operation) {
        case 'delete':
          await batchDeletePhones({ ids: selectedRowKeys });
          message.success(`å·²åˆ é™¤ ${selectedRowKeys.length} ä¸ªæ‰‹æœºå·`);
          break;
        case 'activate':
          await batchUpdateStatus({ ids: selectedRowKeys, status: 'ACTIVE' });
          message.success(`å·²å¯ç”¨ ${selectedRowKeys.length} ä¸ªæ‰‹æœºå·`);
          break;
        case 'deactivate':
          await batchUpdateStatus({ ids: selectedRowKeys, status: 'INACTIVE' });
          message.success(`å·²ç¦ç”¨ ${selectedRowKeys.length} ä¸ªæ‰‹æœºå·`);
          break;
      }
      
      setSelectedRowKeys([]);
      refetch();
    } catch (error) {
      message.error('æ‰¹é‡æ“ä½œå¤±è´¥ï¼Œè¯·é‡è¯•');
    } finally {
      setLoading(false);
    }
  };

  return {
    selectedRowKeys,
    setSelectedRowKeys,
    handleBatchOperation,
    selectedCount: selectedRowKeys.length
  };
};

// æ‰¹é‡æ“ä½œå·¥å…·æ 
const BatchActionBar: React.FC = ({ selectedCount, onBatchOperation }) => {
  if (selectedCount === 0) return null;

  return (
    <div className="batch-action-bar">
      <Alert
        message={`å·²é€‰ä¸­ ${selectedCount} ä¸ªæ‰‹æœºå·`}
        type="info"
        action={
          <Space>
            <Button size="small" onClick={() => onBatchOperation('activate')}>
              æ‰¹é‡å¯ç”¨
            </Button>
            <Button size="small" onClick={() => onBatchOperation('deactivate')}>
              æ‰¹é‡ç¦ç”¨
            </Button>
            <Button 
              size="small" 
              danger 
              onClick={() => onBatchOperation('delete')}
            >
              æ‰¹é‡åˆ é™¤
            </Button>
          </Space>
        }
      />
    </div>
  );
};
```

**ä¼˜åŠ¿**:
- âœ… **ç®€å•å¯é **: åŸºäºæ•°ç»„çš„é€‰æ‹©çŠ¶æ€ï¼Œä¸ä¼šå‡ºé”™
- âœ… **æ€§èƒ½å¤Ÿç”¨**: é¡µé¢çº§é€‰æ‹©ï¼Œæœ€å¤š50ä¸ªçŠ¶æ€ç®¡ç†
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**: æ¸…æ™°çš„æ“ä½œæç¤ºå’Œç»“æœåé¦ˆ

### **3. æ–‡ä»¶å¯¼å…¥ - æ ‡å‡†ä¸Šä¼ ç»„ä»¶**

```typescript
// ä½¿ç”¨ Ant Design Uploadï¼Œæ”¯æŒæ‹–æ‹½å’Œç‚¹å‡»
const ImportModal: React.FC = ({ visible, blacklistId, onClose, onSuccess }) => {
  const [importing, setImporting] = useState(false);
  const [importResult, setImportResult] = useState<ImportResult>();

  const handleFileUpload = async (file: File) => {
    if (file.size > 10 * 1024 * 1024) {
      message.error('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB');
      return false;
    }

    const allowedTypes = [
      'text/csv',
      'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
      'application/vnd.ms-excel',
      'text/plain'
    ];

    if (!allowedTypes.includes(file.type)) {
      message.error('åªæ”¯æŒ CSVã€Excelã€TXT æ ¼å¼çš„æ–‡ä»¶');
      return false;
    }

    try {
      setImporting(true);
      const formData = new FormData();
      formData.append('file', file);
      formData.append('skip_duplicates', 'true');
      formData.append('validate_format', 'true');

      const result = await importPhones({ blacklistId, formData }).unwrap();
      
      setImportResult(result);
      message.success(`å¯¼å…¥å®Œæˆï¼æˆåŠŸ: ${result.imported}æ¡ï¼Œè·³è¿‡: ${result.skipped}æ¡`);
      
      if (result.errors > 0) {
        message.warning(`æœ‰ ${result.errors} æ¡æ•°æ®æ ¼å¼é”™è¯¯ï¼Œå·²è·³è¿‡`);
      }
      
      onSuccess?.(result);
    } catch (error) {
      message.error('å¯¼å…¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼å’Œç½‘ç»œè¿æ¥');
      console.error('Import error:', error);
    } finally {
      setImporting(false);
    }
    
    return false; // é˜»æ­¢é»˜è®¤ä¸Šä¼ è¡Œä¸º
  };

  return (
    <Modal
      title="æ‰¹é‡å¯¼å…¥æ‰‹æœºå·"
      visible={visible}
      onCancel={onClose}
      footer={null}
      width={600}
    >
      <div className="import-modal-content">
        <Alert
          message="æ”¯æŒæ ¼å¼"
          description="CSVã€Excelã€TXTæ–‡ä»¶ï¼Œæ¯è¡Œä¸€ä¸ªæ‰‹æœºå·ï¼Œæ–‡ä»¶å¤§å°é™åˆ¶10MB"
          type="info"
          style={{ marginBottom: 16 }}
        />

        <Dragger
          accept=".csv,.xlsx,.xls,.txt"
          beforeUpload={handleFileUpload}
          showUploadList={false}
          disabled={importing}
        >
          <p className="ant-upload-drag-icon">
            <InboxOutlined />
          </p>
          <p className="ant-upload-text">
            ç‚¹å‡»æˆ–æ‹–æ‹½æ–‡ä»¶åˆ°è¿™é‡Œä¸Šä¼ 
          </p>
          <p className="ant-upload-hint">
            æ”¯æŒå•ä¸ªæ–‡ä»¶ä¸Šä¼ ï¼Œå»ºè®®ä½¿ç”¨CSVæ ¼å¼
          </p>
        </Dragger>

        {importing && (
          <div style={{ textAlign: 'center', marginTop: 16 }}>
            <Spin />
            <p>æ­£åœ¨å¯¼å…¥ä¸­ï¼Œè¯·ç¨å€™...</p>
          </div>
        )}

        {importResult && (
          <div style={{ marginTop: 16 }}>
            <Result
              status="success"
              title="å¯¼å…¥å®Œæˆ"
              subTitle={
                <Space direction="vertical">
                  <p>æˆåŠŸå¯¼å…¥: {importResult.imported} æ¡</p>
                  <p>é‡å¤è·³è¿‡: {importResult.skipped} æ¡</p>
                  <p>æ ¼å¼é”™è¯¯: {importResult.errors} æ¡</p>
                </Space>
              }
            />
          </div>
        )}
      </div>
    </Modal>
  );
};
```

**ä¼˜åŠ¿**:
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**: æ‹–æ‹½ä¸Šä¼ ï¼Œç›´è§‚æ˜“ç”¨
- âœ… **é”™è¯¯å¤„ç†å®Œå–„**: æ–‡ä»¶ç±»å‹ã€å¤§å°éªŒè¯
- âœ… **åé¦ˆæ¸…æ™°**: å¯¼å…¥ç»“æœè¯¦ç»†å±•ç¤º
- âœ… **æŠ€æœ¯æˆç†Ÿ**: åŸºäºæ ‡å‡†Uploadç»„ä»¶

### **4. æœç´¢ç­›é€‰ - ç®€å•æœ‰æ•ˆ**

```typescript
// ç®€å•çš„æœç´¢å’Œç­›é€‰æ 
const SearchFilterBar: React.FC = ({ onSearch, onFilter }) => {
  const [searchQuery, setSearchQuery] = useState('');
  const [statusFilter, setStatusFilter] = useState<'ALL' | 'ACTIVE' | 'INACTIVE'>('ALL');

  const handleSearch = useDebouncedCallback((value: string) => {
    onSearch(value);
  }, 300);

  return (
    <Row gutter={16} style={{ marginBottom: 16 }}>
      <Col span={12}>
        <Input.Search
          placeholder="æœç´¢æ‰‹æœºå·..."
          value={searchQuery}
          onChange={(e) => {
            setSearchQuery(e.target.value);
            handleSearch(e.target.value);
          }}
          onSearch={onSearch}
          allowClear
        />
      </Col>
      
      <Col span={6}>
        <Select
          value={statusFilter}
          onChange={(value) => {
            setStatusFilter(value);
            onFilter({ status: value === 'ALL' ? undefined : value });
          }}
          style={{ width: '100%' }}
        >
          <Select.Option value="ALL">å…¨éƒ¨çŠ¶æ€</Select.Option>
          <Select.Option value="ACTIVE">å¯ç”¨</Select.Option>
          <Select.Option value="INACTIVE">ç¦ç”¨</Select.Option>
        </Select>
      </Col>
      
      <Col span={6}>
        <Button type="primary" icon={<ReloadOutlined />} onClick={() => window.location.reload()}>
          åˆ·æ–°
        </Button>
      </Col>
    </Row>
  );
};

// é˜²æŠ–Hook
const useDebouncedCallback = (callback: (value: string) => void, delay: number) => {
  const [debouncedCallback] = useState(() =>
    debounce(callback, delay)
  );
  
  useEffect(() => {
    return () => {
      debouncedCallback.cancel();
    };
  }, [debouncedCallback]);
  
  return debouncedCallback;
};
```

## ğŸ—ï¸ **ç»„ä»¶æ¶æ„è®¾è®¡**

### **ç®€åŒ–çš„ç»„ä»¶ç»“æ„**

```typescript
BlacklistManagementPage/
â”œâ”€â”€ BlacklistTable.tsx                # é»‘åå•åˆ—è¡¨è¡¨æ ¼
â”œâ”€â”€ PhoneManagementModal/             # æ‰‹æœºå·ç®¡ç†å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ PhoneManagementModal.tsx     # ä¸»å¯¹è¯æ¡† (800x600)
â”‚   â”œâ”€â”€ PhoneTable.tsx               # æ‰‹æœºå·è¡¨æ ¼
â”‚   â”œâ”€â”€ SearchFilterBar.tsx          # æœç´¢ç­›é€‰æ 
â”‚   â”œâ”€â”€ BatchActionBar.tsx           # æ‰¹é‡æ“ä½œå·¥å…·æ 
â”‚   â””â”€â”€ PhoneStatistics.tsx          # ç»Ÿè®¡ä¿¡æ¯
â”œâ”€â”€ ImportModal.tsx                   # å¯¼å…¥å¯¹è¯æ¡†
â”œâ”€â”€ ExportButton.tsx                  # å¯¼å‡ºæŒ‰é’®
â””â”€â”€ BlacklistForm.tsx                # åˆ›å»º/ç¼–è¾‘é»‘åå•è¡¨å•

// ä¸éœ€è¦çš„å¤æ‚ç»„ä»¶ï¼š
// âŒ VirtualizedPhoneList
// âŒ InfiniteScrollLoader  
// âŒ ComplexCacheManager
// âŒ FileChunkProcessor
// âŒ AdvancedProgressIndicator
```

### **ä¸»è¦ç»„ä»¶è®¾è®¡**

#### **PhoneManagementModal.tsx** (æ ¸å¿ƒç»„ä»¶)
```typescript
interface PhoneManagementModalProps {
  visible: boolean;
  blacklist: Blacklist;
  onClose: () => void;
}

const PhoneManagementModal: React.FC<PhoneManagementModalProps> = ({
  visible,
  blacklist,
  onClose
}) => {
  // æœç´¢å’Œç­›é€‰çŠ¶æ€
  const [searchQuery, setSearchQuery] = useState('');
  const [filters, setFilters] = useState<PhoneFilters>({});
  
  // åˆ†é¡µçŠ¶æ€
  const [pagination, setPagination] = useState({ current: 1, pageSize: 50, total: 0 });
  
  // æ‰¹é‡é€‰æ‹©
  const { selectedRowKeys, setSelectedRowKeys, handleBatchOperation, selectedCount } = useBatchSelection();
  
  // å¯¼å…¥å¯¼å‡º
  const [importModalVisible, setImportModalVisible] = useState(false);

  return (
    <Modal
      title={`ç®¡ç†é»‘åå•: ${blacklist.name}`}
      visible={visible}
      onCancel={onClose}
      width={1200}
      footer={[
        <Button key="close" onClick={onClose}>
          å…³é—­
        </Button>
      ]}
      destroyOnClose
    >
      <div className="phone-management-content">
        {/* ç»Ÿè®¡ä¿¡æ¯ */}
        <PhoneStatistics blacklist={blacklist} />
        
        {/* æ“ä½œå·¥å…·æ  */}
        <div className="toolbar" style={{ marginBottom: 16 }}>
          <Space>
            <Button 
              type="primary" 
              icon={<PlusOutlined />}
              onClick={() => setImportModalVisible(true)}
            >
              æ‰¹é‡å¯¼å…¥
            </Button>
            <ExportButton blacklistId={blacklist.id} />
            <Button 
              icon={<ReloadOutlined />} 
              onClick={() => refetch()}
            >
              åˆ·æ–°
            </Button>
          </Space>
        </div>

        {/* æœç´¢ç­›é€‰æ  */}
        <SearchFilterBar 
          onSearch={setSearchQuery}
          onFilter={setFilters}
        />

        {/* æ‰¹é‡æ“ä½œæç¤º */}
        <BatchActionBar 
          selectedCount={selectedCount}
          onBatchOperation={handleBatchOperation}
        />

        {/* æ‰‹æœºå·è¡¨æ ¼ */}
        <PhoneTable
          blacklistId={blacklist.id}
          searchQuery={searchQuery}
          filters={filters}
          pagination={pagination}
          onPaginationChange={setPagination}
          selectedRowKeys={selectedRowKeys}
          onSelectionChange={setSelectedRowKeys}
        />
      </div>

      {/* å¯¼å…¥å¯¹è¯æ¡† */}
      <ImportModal
        visible={importModalVisible}
        blacklistId={blacklist.id}
        onClose={() => setImportModalVisible(false)}
        onSuccess={() => {
          refetch();
          setImportModalVisible(false);
        }}
      />
    </Modal>
  );
};
```

## âš¡ **çŠ¶æ€ç®¡ç†è®¾è®¡**

### **RTK Query APIé›†æˆ** (æ ‡å‡†ç”¨æ³•)

```typescript
// ä½¿ç”¨RTK Queryçš„æ ‡å‡†åŠŸèƒ½ï¼Œä¸éœ€è¦å¤æ‚ç¼“å­˜ç­–ç•¥
export const phoneApi = createApi({
  reducerPath: 'phoneApi',
  baseQuery: fetchBaseQuery({
    baseUrl: '/api/v1/',
    prepareHeaders: (headers, { getState }) => {
      const token = (getState() as RootState).auth.token;
      if (token) {
        headers.set('Authorization', `Bearer ${token}`);
      }
      return headers;
    },
  }),
  tagTypes: ['Phone', 'Blacklist'],
  endpoints: (builder) => ({
    // è·å–æ‰‹æœºå·åˆ—è¡¨ - æ ‡å‡†åˆ†é¡µæŸ¥è¯¢
    getPhones: builder.query<PhoneListResponse, PhoneQueryParams>({
      query: ({ blacklistId, page = 1, per_page = 50, search, status }) => ({
        url: `blacklists/${blacklistId}/phones`,
        params: { page, per_page, search, status }
      }),
      providesTags: (result, error, { blacklistId }) => [
        { type: 'Phone', id: 'LIST' },
        { type: 'Phone', id: blacklistId }
      ],
    }),

    // æ‰¹é‡å¯¼å…¥ - æ–‡ä»¶ä¸Šä¼ 
    importPhones: builder.mutation<ImportResult, ImportRequest>({
      query: ({ blacklistId, formData }) => ({
        url: `blacklists/${blacklistId}/batch-import`,
        method: 'POST',
        body: formData,
      }),
      invalidatesTags: (result, error, { blacklistId }) => [
        { type: 'Phone', id: 'LIST' },
        { type: 'Phone', id: blacklistId },
        { type: 'Blacklist', id: blacklistId }
      ],
    }),

    // æ‰¹é‡åˆ é™¤
    batchDeletePhones: builder.mutation<BatchResult, BatchDeleteRequest>({
      query: ({ blacklistId, ids }) => ({
        url: `blacklists/${blacklistId}/batch-delete`,
        method: 'POST',
        body: { ids },
      }),
      invalidatesTags: (result, error, { blacklistId }) => [
        { type: 'Phone', id: 'LIST' },
        { type: 'Phone', id: blacklistId },
        { type: 'Blacklist', id: blacklistId }
      ],
    }),

    // æ‰¹é‡æ›´æ–°çŠ¶æ€
    batchUpdateStatus: builder.mutation<BatchResult, BatchUpdateRequest>({
      query: ({ blacklistId, ids, status }) => ({
        url: `blacklists/${blacklistId}/batch-update`,
        method: 'POST',
        body: { ids, status },
      }),
      invalidatesTags: (result, error, { blacklistId }) => [
        { type: 'Phone', id: 'LIST' },
        { type: 'Phone', id: blacklistId },
        { type: 'Blacklist', id: blacklistId }
      ],
    }),

    // å¯¼å‡ºæ‰‹æœºå·
    exportPhones: builder.query<Blob, ExportRequest>({
      query: ({ blacklistId, format = 'csv' }) => ({
        url: `blacklists/${blacklistId}/export`,
        params: { format },
        responseHandler: (response) => response.blob(),
      }),
    }),
  }),
});

export const {
  useGetPhonesQuery,
  useImportPhonesMutation,
  useBatchDeletePhonesMutation,
  useBatchUpdateStatusMutation,
  useExportPhonesQuery,
} = phoneApi;
```

**ä¼˜åŠ¿**:
- âœ… **ç®€å•å¯é **: ä½¿ç”¨RTK Queryæ ‡å‡†åŠŸèƒ½
- âœ… **è‡ªåŠ¨ç¼“å­˜**: åŸºæœ¬çš„ç¼“å­˜å’Œå¤±æ•ˆç­–ç•¥è¶³å¤Ÿç”¨
- âœ… **ç±»å‹å®‰å…¨**: TypeScriptå®Œæ•´ç±»å‹æ”¯æŒ
- âœ… **é”™è¯¯å¤„ç†**: å†…ç½®é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸ§ª **æµ‹è¯•ç­–ç•¥**

### **å•å…ƒæµ‹è¯•** (ç®€åŒ–ç‰ˆ)
```typescript
// ç»„ä»¶åŸºæœ¬åŠŸèƒ½æµ‹è¯•
describe('PhoneManagementModal', () => {
  it('åº”è¯¥æ­£ç¡®æ¸²æŸ“æ‰‹æœºå·åˆ—è¡¨', () => {
    render(<PhoneManagementModal visible={true} blacklist={mockBlacklist} />);
    expect(screen.getByRole('table')).toBeInTheDocument();
  });

  it('æœç´¢åŠŸèƒ½åº”è¯¥å·¥ä½œæ­£å¸¸', async () => {
    render(<PhoneManagementModal visible={true} blacklist={mockBlacklist} />);
    const searchInput = screen.getByPlaceholderText('æœç´¢æ‰‹æœºå·...');
    
    fireEvent.change(searchInput, { target: { value: '138' } });
    
    await waitFor(() => {
      expect(mockUseGetPhonesQuery).toHaveBeenCalledWith(
        expect.objectContaining({ search: '138' })
      );
    });
  });
});

// APIé›†æˆæµ‹è¯•
describe('phoneApi', () => {
  it('æ‰¹é‡å¯¼å…¥åº”è¯¥æ­£ç¡®è°ƒç”¨API', async () => {
    const mockFile = new File(['13812345678\n13987654321'], 'test.csv', {
      type: 'text/csv'
    });
    
    const formData = new FormData();
    formData.append('file', mockFile);

    const result = await store.dispatch(
      phoneApi.endpoints.importPhones.initiate({
        blacklistId: 'test-id',
        formData
      })
    );

    expect(result.data).toEqual({
      imported: 2,
      skipped: 0,
      errors: 0
    });
  });
});
```

### **é›†æˆæµ‹è¯•**
```typescript
// ç”¨æˆ·æ“ä½œæµç¨‹æµ‹è¯•
describe('ç”¨æˆ·æ“ä½œæµç¨‹', () => {
  it('ç”¨æˆ·åº”è¯¥èƒ½å¤Ÿå®Œæˆå®Œæ•´çš„å¯¼å…¥æµç¨‹', async () => {
    // 1. æ‰“å¼€æ‰‹æœºå·ç®¡ç†å¯¹è¯æ¡†
    render(<BlacklistManagementPage />);
    fireEvent.click(screen.getByText('ç®¡ç†'));
    
    // 2. ç‚¹å‡»æ‰¹é‡å¯¼å…¥
    fireEvent.click(screen.getByText('æ‰¹é‡å¯¼å…¥'));
    
    // 3. ä¸Šä¼ æ–‡ä»¶
    const file = new File(['13812345678'], 'test.csv', { type: 'text/csv' });
    const upload = screen.getByRole('button', { name: /ä¸Šä¼ / });
    fireEvent.change(upload, { target: { files: [file] } });
    
    // 4. éªŒè¯ç»“æœ
    await waitFor(() => {
      expect(screen.getByText(/å¯¼å…¥å®Œæˆ/)).toBeInTheDocument();
    });
  });
});
```

## ğŸ“Š **æ€§èƒ½åŸºå‡†** (ç°å®ç›®æ ‡)

| åœºæ™¯ | æ•°æ®é‡ | ç›®æ ‡æ€§èƒ½ | å®ç°æ–¹æ¡ˆ |
|------|--------|----------|----------|
| é¡µé¢é¦–æ¬¡åŠ è½½ | 50æ¡/é¡µ | < 1s | æ ‡å‡†Tableç»„ä»¶ |
| ç¿»é¡µå“åº” | ä»»æ„é¡µ | < 500ms | æ ‡å‡†åˆ†é¡µ |
| æœç´¢å“åº” | 1-2ä¸‡æ¡ | < 1s | æœåŠ¡ç«¯æœç´¢ + é˜²æŠ– |
| æ‰¹é‡é€‰æ‹© | 50æ¡/é¡µ | ç¬æ—¶ | æ•°ç»„çŠ¶æ€ç®¡ç† |
| æ–‡ä»¶å¯¼å…¥ | < 10MB | < 30s | æ ‡å‡†Upload |

## âœ… **éªŒæ”¶æ ‡å‡†** (ç®€åŒ–ç‰ˆ)

### **åŠŸèƒ½éªŒæ”¶**
- [ ] èƒ½å¤Ÿåˆ†é¡µæµè§ˆæ‰‹æœºå·åˆ—è¡¨ (50æ¡/é¡µ)
- [ ] æœç´¢å’ŒçŠ¶æ€ç­›é€‰æ­£å¸¸å·¥ä½œ
- [ ] æ‰¹é‡é€‰æ‹©å½“å‰é¡µé¢çš„æ‰‹æœºå·
- [ ] æ‰¹é‡åˆ é™¤ã€å¯ç”¨ã€ç¦ç”¨æ“ä½œæˆåŠŸ
- [ ] CSV/Excelæ–‡ä»¶å¯¼å…¥æˆåŠŸ (< 10MB)
- [ ] å¯¼å‡ºæ‰‹æœºå·åˆ—è¡¨ä¸ºCSVæ ¼å¼
- [ ] æ“ä½œç»“æœæœ‰æ˜ç¡®çš„æˆåŠŸ/å¤±è´¥æç¤º

### **æ€§èƒ½éªŒæ”¶**
- [ ] é¡µé¢åŠ è½½æ—¶é—´ < 1s
- [ ] ç¿»é¡µå“åº”æ—¶é—´ < 500ms
- [ ] æœç´¢å“åº”æ—¶é—´ < 1s
- [ ] æ–‡ä»¶å¯¼å…¥æœ‰è¿›åº¦æç¤º

### **ç”¨æˆ·ä½“éªŒéªŒæ”¶**
- [ ] ç•Œé¢ç®€æ´ï¼Œæ“ä½œç›´è§‚
- [ ] é”™è¯¯æç¤ºæ¸…æ™°æ˜“æ‡‚
- [ ] åŠ è½½çŠ¶æ€æœ‰æ˜ç¡®åé¦ˆ
- [ ] æ”¯æŒé”®ç›˜å¿«æ·æ“ä½œ

## ğŸ“‹ **å®æ–½è®¡åˆ’**

### **Day 1: å®Œæ•´å®æ–½ (6-8å°æ—¶)**

#### **ä¸Šåˆ (4å°æ—¶): åŸºç¡€ç•Œé¢**
- [ ] **1å°æ—¶**: PhoneManagementModal ä¸»å¯¹è¯æ¡†
  - å¯¹è¯æ¡†å¸ƒå±€å’ŒåŸºæœ¬ç»“æ„
  - ç»Ÿè®¡ä¿¡æ¯å±•ç¤º
- [ ] **1å°æ—¶**: PhoneTable æ‰‹æœºå·è¡¨æ ¼
  - è¡¨æ ¼åˆ—å®šä¹‰
  - åˆ†é¡µåŠŸèƒ½é›†æˆ
- [ ] **1å°æ—¶**: SearchFilterBar æœç´¢ç­›é€‰
  - æœç´¢è¾“å…¥æ¡† + é˜²æŠ–
  - çŠ¶æ€ç­›é€‰ä¸‹æ‹‰æ¡†
- [ ] **1å°æ—¶**: BatchActionBar æ‰¹é‡æ“ä½œ
  - æ‰¹é‡é€‰æ‹©çŠ¶æ€ç®¡ç†
  - æ‰¹é‡æ“ä½œæŒ‰é’®å’Œé€»è¾‘

#### **ä¸‹åˆ (3å°æ—¶): å¯¼å…¥å¯¼å‡º**
- [ ] **1.5å°æ—¶**: ImportModal å¯¼å…¥å¯¹è¯æ¡†
  - æ–‡ä»¶ä¸Šä¼ ç»„ä»¶ (æ‹–æ‹½æ”¯æŒ)
  - æ ¼å¼éªŒè¯å’Œé”™è¯¯å¤„ç†
  - å¯¼å…¥ç»“æœå±•ç¤º
- [ ] **1å°æ—¶**: ExportButton å¯¼å‡ºåŠŸèƒ½
  - å¯¼å‡ºæŒ‰é’®å’ŒAPIè°ƒç”¨
  - æ–‡ä»¶ä¸‹è½½å¤„ç†
- [ ] **0.5å°æ—¶**: é”™è¯¯å¤„ç†å’Œæç¤º
  - Message ç»„ä»¶é›†æˆ
  - ç»Ÿä¸€é”™è¯¯å¤„ç†

#### **æµ‹è¯•éªŒè¯ (1å°æ—¶)**
- [ ] **0.5å°æ—¶**: å‰åç«¯è”è°ƒæµ‹è¯•
  - APIæ¥å£è°ƒç”¨éªŒè¯
  - æ•°æ®æ ¼å¼ç¡®è®¤
- [ ] **0.5å°æ—¶**: åŸºæœ¬åŠŸèƒ½æµ‹è¯•
  - å¯¼å…¥å¯¼å‡ºåŠŸèƒ½éªŒè¯
  - æ‰¹é‡æ“ä½œæµ‹è¯•

## ğŸ¯ **æ€»ç»“**

### **ç®€åŒ–æ–¹æ¡ˆä¼˜åŠ¿**
- âœ… **æŠ€æœ¯é£é™©ä½**: ä½¿ç”¨æˆç†Ÿçš„Ant Designç»„ä»¶
- âœ… **å¼€å‘æ•ˆç‡é«˜**: 6-8å°æ—¶å®Œæˆï¼Œç¡®å®šæ€§å¼º
- âœ… **ç»´æŠ¤æˆæœ¬ä½**: ä»£ç ç®€æ´ï¼Œæ˜“äºç†è§£å’Œä¿®æ”¹
- âœ… **ç”¨æˆ·ä½“éªŒå¥½**: ç•Œé¢ç†Ÿæ‚‰ï¼Œæ“ä½œç›´è§‚
- âœ… **æ‰©å±•æ€§å¥½**: æœªæ¥éœ€è¦æ—¶å¯ä»¥é€æ­¥ä¼˜åŒ–

### **é€‚ç”¨æ•°æ®è§„æ¨¡**
- âœ… **å½“å‰**: 1-2ä¸‡æ¡æ‰‹æœºå·ï¼Œå®Œå…¨æ»¡è¶³éœ€æ±‚
- âœ… **è¿‘æœŸ**: 5-10ä¸‡æ¡æ‰‹æœºå·ï¼Œæ€§èƒ½ä¾ç„¶è‰¯å¥½
- âœ… **è¿œæœŸ**: å¦‚æœçœŸçš„è¾¾åˆ°ç™¾ä¸‡çº§ï¼Œå†è€ƒè™‘æŠ€æœ¯å‡çº§

### **æŠ€æœ¯å€ºåŠ¡æ§åˆ¶**
- âœ… **ä»£ç è´¨é‡**: ä½¿ç”¨æ ‡å‡†ç»„ä»¶å’Œæ¨¡å¼ï¼Œä»£ç å¯è¯»æ€§é«˜
- âœ… **æ€§èƒ½åŸºå‡†**: æ˜ç¡®çš„æ€§èƒ½ç›®æ ‡ï¼Œé¿å…è¿‡æ—©ä¼˜åŒ–
- âœ… **å‡çº§è·¯å¾„**: æœ‰æ˜ç¡®çš„æŠ€æœ¯å‡çº§è·¯å¾„ï¼Œä¸ä¼šå½¢æˆæŠ€æœ¯æ­»èƒ¡åŒ

è¿™æ˜¯ä¸€ä¸ª**å¹³è¡¡äº†åŠŸèƒ½ã€æ€§èƒ½ã€é£é™©ã€æˆæœ¬**çš„æœ€ä¼˜æ–¹æ¡ˆã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0 (ç®€åŒ–å®ç”¨ç‰ˆ)  
**åˆ›å»ºæ—¶é—´**: 2025-01-12  
**è®¾è®¡ç†å¿µ**: ä¿å®ˆå®ç”¨ï¼Œé¿å…è¿‡åº¦è®¾è®¡  
**è´Ÿè´£äºº**: Claude Code Assistant  
**æŠ€æœ¯æ ˆ**: React 18 + TypeScript + RTK Query + Ant Design (æ ‡å‡†ç”¨æ³•)  
**é¢„è®¡å·¥æœŸ**: 1ä¸ªå·¥ä½œæ—¥ (6-8å°æ—¶)