# ç™½åå•åŠŸèƒ½å¼€å‘è®¡åˆ’ï¼ˆç®€åŒ–ç‰ˆï¼‰

## ğŸ“Š é¡¹ç›®æ¦‚å†µ

**å¼€å‘æ¨¡å—**: ç™½åå•ç®¡ç†ç³»ç»Ÿï¼ˆä¼˜å…ˆé€šè¿‡ç®¡ç†ï¼‰  
**åŠŸèƒ½èŒƒå›´**: VIPå®¢æˆ·ä¼˜å…ˆçº§ç®¡ç†å’Œç™½åå•åº“ç»´æŠ¤  
**å¼€å‘å‘¨æœŸ**: 2.5ä¸ªå·¥ä½œæ—¥  
**é¢„ä¼°å·¥æ—¶**: 20å°æ—¶  
**æŠ€æœ¯æ¶æ„**: åŸºäºç°æœ‰æ¶æ„çš„ç®€åŒ–è®¾è®¡ï¼Œä¸“æ³¨ä¼˜å…ˆçº§å’ŒVIPç®¡ç†

## ğŸ¯ éœ€æ±‚åˆ†ææ€»ç»“

### æ ¸å¿ƒåŠŸèƒ½èŒƒå›´ï¼ˆåŸºäºFEAT-6-9ï¼Œç®€åŒ–è®¾è®¡ï¼‰

**âœ… åŸºç¡€ç™½åå•ç®¡ç†**ï¼ˆé‡ç‚¹ç®€åŒ–ï¼‰:
- æ‰‹æœºå·ç™½åå•ï¼ˆVIPå®¢æˆ·ä¼˜å…ˆï¼‰
- å…³é”®è¯ç™½åå•ï¼ˆé‡è¦å†…å®¹ä¼˜å…ˆï¼‰
- ç®€å•çš„IPå’ŒåŸŸåç™½åå•
- **å»æ‰**: å¤æ‚çš„æ­£åˆ™åŒ¹é…ï¼Œå¤æ‚çš„å†…å®¹æ£€æµ‹

**âœ… ä¼˜å…ˆçº§ç®¡ç†**ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰:
- 3çº§ä¼˜å…ˆçº§ï¼šé«˜(7-10)/ä¸­(4-6)/ä½(1-3)
- VIPè‡ªåŠ¨æœ€é«˜ä¼˜å…ˆçº§(10)
- ç®€å•çš„ä¼˜å…ˆçº§å†²çªè§„åˆ™ï¼šå–æœ€é«˜å€¼
- **å»æ‰**: å¤æ‚çš„æƒé‡è®¡ç®—ï¼Œå¤æ‚çš„å†²çªç®—æ³•

**âœ… VIPå®¢æˆ·ç®¡ç†**ï¼ˆç‰¹è‰²åŠŸèƒ½ï¼‰:
- VIPæ ‡è®°å’Œç­‰çº§ç®¡ç†
- VIPä¸“å±ä¼˜å…ˆçº§
- **å»æ‰**: å¤æ‚çš„VIPé€šé“ï¼Œå¤æ‚çš„VIPé…ç½®

**âœ… ç®€åŒ–ç»Ÿè®¡**ï¼ˆå¿…è¦åŠŸèƒ½ï¼‰:
- åŸºç¡€ä¼˜å…ˆé€šè¿‡ç»Ÿè®¡
- VIPä½¿ç”¨ç»Ÿè®¡
- **å»æ‰**: å¤æ‚çš„æ€§èƒ½åˆ†æï¼Œå¤æ‚çš„æ•ˆæœæŠ¥å‘Š

## ğŸ“‹ ä¸é»‘åå•ç³»ç»Ÿå¯¹æ¯”åˆ†æ

### âš ï¸ é‡è¦æé†’ï¼šç™½åå•éœ€æ±‚æ›´ç®€å•ï¼Œé¿å…è¿‡åº¦è®¾è®¡

| åŠŸèƒ½æ¨¡å— | é»‘åå•ç³»ç»Ÿ | ç™½åå•ç³»ç»Ÿ | è®¾è®¡ç­–ç•¥ |
|---------|-----------|-----------|----------|
| æ•°æ®æ¨¡å‹ | å¤æ‚ï¼ˆä¸¥é‡ç­‰çº§ã€æ—¶æ•ˆæ€§ã€æ­£åˆ™ï¼‰ | **ç®€åŒ–**ï¼ˆåªéœ€ä¼˜å…ˆçº§ï¼‰ | ç®€åŒ–60% |
| å†…å®¹åŒ¹é… | å¤æ‚ï¼ˆæ­£åˆ™ã€æ¨¡ç³ŠåŒ¹é…ï¼‰ | **ç®€å•**ï¼ˆç²¾ç¡®åŒ¹é…ï¼‰ | ç®€åŒ–80% |  
| ç»Ÿè®¡åˆ†æ | æ‹¦æˆªã€è¯¯æ‹¦æˆªã€æ•ˆæœ | **åŸºç¡€**ï¼ˆé€šè¿‡ç»Ÿè®¡ï¼‰ | ç®€åŒ–70% |
| å‰ç«¯ç•Œé¢ | å¤æ‚è¡¨å•ã€å¤šå¼¹çª— | **ç²¾ç®€**ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ | ç®€åŒ–50% |

### ç™½åå•ç®€åŒ–åŸåˆ™
- **æ•°æ®æ¨¡å‹**: å»æ‰severityã€æ­£åˆ™ç›¸å…³ã€å¤æ‚æ—¶æ•ˆæ€§
- **æœåŠ¡é€»è¾‘**: å»æ‰å¤æ‚åŒ¹é…å¼•æ“ï¼Œåªä¿ç•™ä¼˜å…ˆçº§å¤„ç†
- **APIæ¥å£**: å‡å°‘ç«¯ç‚¹æ•°é‡ï¼Œä¸“æ³¨æ ¸å¿ƒCRUD + ä¼˜å…ˆçº§
- **å‰ç«¯ç•Œé¢**: ç²¾ç®€UIï¼Œä¸“æ³¨VIPç®¡ç†å’Œä¼˜å…ˆçº§è®¾ç½®

## ğŸ—“ï¸ åˆ†é˜¶æ®µå¼€å‘è®¡åˆ’ï¼ˆç®€åŒ–ç‰ˆï¼‰

### ç¬¬ä¸€é˜¶æ®µï¼šç™½åå•æ•°æ®æ¨¡å‹ï¼ˆ0.5å¤© / 4å°æ—¶ï¼‰

#### ä»»åŠ¡1.1: ç®€åŒ–æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆ2å°æ—¶ï¼‰

**ä¿®æ­£åçš„æ•°æ®åº“Schema**ï¼ˆå‚ç…§é»‘åå•æ¶æ„ï¼‰:
```sql
-- 1. ç™½åå•ä¸»è¡¨ï¼ˆç±»ä¼¼blacklistsè¡¨ï¼‰
CREATE TABLE whitelists (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    name VARCHAR(200) NOT NULL UNIQUE,          -- ç™½åå•åç§° "VIPå®¢æˆ·ç™½åå•"
    description TEXT,                           -- ç™½åå•æè¿°
    
    -- é»˜è®¤ä¼˜å…ˆçº§è®¾ç½®ï¼ˆå¯è¢«æ¡ç›®è¦†ç›–ï¼‰
    default_priority_level INTEGER DEFAULT 1,   -- é»˜è®¤ä¼˜å…ˆçº§ï¼š1-10
    is_vip_list BOOLEAN DEFAULT FALSE,          -- æ˜¯å¦VIPç™½åå•
    
    -- çŠ¶æ€ç®¡ç†
    status whitelist_status_enum DEFAULT 'active',
    
    -- ç»Ÿè®¡ä¿¡æ¯ï¼ˆå†—ä½™å­—æ®µï¼Œæ€§èƒ½ä¼˜åŒ–ï¼‰
    entry_count INTEGER DEFAULT 0,             -- æ¡ç›®æ•°é‡
    match_count INTEGER DEFAULT 0,             -- åŒ¹é…æ¬¡æ•°
    last_match_at TIMESTAMP,                   -- æœ€ååŒ¹é…æ—¶é—´
    
    -- ç®¡ç†ä¿¡æ¯ï¼ˆæ— ä¼ä¸šéš”ç¦»ï¼‰
    created_by INTEGER REFERENCES admin_users(id),
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW(),
    notes TEXT,
    tags TEXT[]                                -- æ ‡ç­¾ä¾¿äºåˆ†ç±»
);

-- 2. ç™½åå•æ¡ç›®è¡¨ï¼ˆç±»ä¼¼blacklist_phone_entriesè¡¨ï¼Œä½†æ”¯æŒå¤šç§å†…å®¹ç±»å‹ï¼‰
CREATE TABLE whitelist_entries (
    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
    
    -- å…³è”ç™½åå•
    whitelist_id UUID NOT NULL REFERENCES whitelists(id) ON DELETE CASCADE,
    
    -- æ¡ç›®å†…å®¹ï¼ˆæ”¯æŒå¤šç§ç±»å‹ï¼‰
    content VARCHAR(500) NOT NULL,             -- å†…å®¹ï¼šæ‰‹æœºå·/å…³é”®è¯/IP/åŸŸå
    content_type whitelist_type_enum NOT NULL, -- å†…å®¹ç±»å‹
    
    -- ä¼˜å…ˆçº§ï¼ˆå¯è¦†ç›–ç™½åå•é»˜è®¤ä¼˜å…ˆçº§ï¼‰
    priority_level INTEGER,                    -- NULL=ä½¿ç”¨ç™½åå•é»˜è®¤å€¼
    is_vip BOOLEAN,                           -- NULL=ä½¿ç”¨ç™½åå•é»˜è®¤å€¼
    
    -- æ¡ç›®çŠ¶æ€
    status whitelist_status_enum DEFAULT 'active',
    
    -- ç»Ÿè®¡ä¿¡æ¯
    match_count INTEGER DEFAULT 0,
    last_match_at TIMESTAMP,
    
    -- å…ƒæ•°æ®
    notes TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    imported_from VARCHAR(100),               -- æ‰¹é‡å¯¼å…¥æ¥æº
    
    -- çº¦æŸ
    UNIQUE(whitelist_id, content, content_type), -- åŒç™½åå•å†…å®¹å”¯ä¸€
    CHECK (priority_level IS NULL OR (priority_level >= 1 AND priority_level <= 10))
);

-- æšä¸¾ç±»å‹ï¼ˆç®€åŒ–ï¼‰
CREATE TYPE whitelist_type_enum AS ENUM ('phone', 'keyword', 'ip', 'domain');
CREATE TYPE whitelist_status_enum AS ENUM ('active', 'inactive');
```

**ä¿®æ­£åçš„åç«¯æ¨¡å‹**ï¼ˆå‚ç…§é»‘åå•æ¶æ„ï¼‰:
```python
pigeon_web/app/models/whitelist/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ whitelist.py               # Whitelistä¸»è¡¨ï¼ˆç±»ä¼¼Blacklistï¼‰
â””â”€â”€ whitelist_entry.py         # WhitelistEntryæ¡ç›®è¡¨ï¼ˆç±»ä¼¼BlacklistPhoneEntryï¼‰
```

**ç®€åŒ–æ¨¡å‹è®¾è®¡åŸåˆ™**:
- å»æ‰å¤æ‚çš„Typeå’ŒSourceå…³è”è¡¨ï¼Œç›´æ¥ç”¨æšä¸¾
- å»æ‰å¤æ‚çš„æƒé‡ã€ä¸¥é‡ç­‰çº§ç­‰å­—æ®µ
- åªä¿ç•™æ ¸å¿ƒçš„ä¼˜å…ˆçº§å’ŒVIPæ ‡è®°
- çŠ¶æ€åªä¿ç•™active/inactiveä¸¤ç§
- å»æ‰å¤æ‚çš„æ—¶æ•ˆæ€§ç®¡ç†

#### ä»»åŠ¡1.2: æ•°æ®åº“åˆå§‹åŒ–ï¼ˆ2å°æ—¶ï¼‰

**ç®€åŒ–é…ç½®**:
```python
# ç›´æ¥åœ¨æ¨¡å‹ä¸­å®šä¹‰æšä¸¾ï¼Œæ— éœ€å¤æ‚é…ç½®è¡¨
class WhitelistType(enum.Enum):
    PHONE = 'phone'        # VIPæ‰‹æœºå·
    KEYWORD = 'keyword'    # ä¼˜å…ˆå…³é”®è¯
    IP = 'ip'             # å¯ä¿¡IP
    DOMAIN = 'domain'     # å¯ä¿¡åŸŸå

class PriorityLevel:
    LOW = range(1, 4)      # 1-3: ä½ä¼˜å…ˆçº§
    MEDIUM = range(4, 7)   # 4-6: ä¸­ä¼˜å…ˆçº§  
    HIGH = range(7, 11)    # 7-10: é«˜ä¼˜å…ˆçº§ï¼ˆVIPè‡ªåŠ¨ä¸º10ï¼‰

# ç®€å•çš„VIPä¼˜å…ˆçº§è§„åˆ™
def get_priority_level(is_vip, manual_priority):
    return 10 if is_vip else manual_priority
```

**SQLæ–‡ä»¶ç»“æ„**ï¼ˆéµå¾ªç°æœ‰æ¨¡å—åŒ–æ¶æ„ï¼‰:
```
pigeon_web/sql/modules/07_whitelist.sql    # ç™½åå•å®Œæ•´æ¨¡å—ï¼ˆå•æ–‡ä»¶åŒ…å«æ‰€æœ‰å†…å®¹ï¼‰
```

**é›†æˆåˆ°ä¸»æ–‡ä»¶**:
```sql
-- pigeon_web/sql/pigeon_web.sql ä¸­æ–°å¢ï¼š
\echo 'Loading whitelist management system...'
\ir modules/07_whitelist.sql
```

**å…³é”®ç´¢å¼•ä¼˜åŒ–**ï¼ˆåŸºäºä¸¤è¡¨æ¶æ„ï¼‰:
```sql
-- ç™½åå•ä¸»è¡¨ç´¢å¼•
CREATE INDEX idx_whitelists_status ON whitelists (status, created_at DESC);
CREATE INDEX idx_whitelists_vip ON whitelists (is_vip_list, default_priority_level DESC);

-- ç™½åå•æ¡ç›®è¡¨ç´¢å¼•ï¼ˆæ ¸å¿ƒæ€§èƒ½ä¼˜åŒ–ï¼‰
CREATE INDEX idx_whitelist_entries_type_priority ON whitelist_entries (content_type, priority_level DESC, status);
CREATE INDEX idx_whitelist_entries_vip_priority ON whitelist_entries (is_vip, priority_level DESC, content_type);
CREATE INDEX idx_whitelist_entries_content_phone ON whitelist_entries (content) WHERE content_type = 'phone';
```

### ç¬¬äºŒé˜¶æ®µï¼šç™½åå•æœåŠ¡å±‚ï¼ˆ1å¤© / 8å°æ—¶ï¼‰

#### ä»»åŠ¡2.1: æ ¸å¿ƒæœåŠ¡å¼€å‘ï¼ˆ6å°æ—¶ï¼‰

**ç®€åŒ–æœåŠ¡ç»“æ„**:
```python
pigeon_web/app/services/whitelist/
â”œâ”€â”€ __init__.py
â”œâ”€â”€ whitelist_service.py          # åŸºç¡€CRUDï¼ˆå¤ç”¨blacklist 80%ï¼‰
â””â”€â”€ priority_service.py           # ä¼˜å…ˆçº§å¤„ç†ï¼ˆç®€åŒ–æ–°å¼€å‘ï¼‰
```

**ç®€åŒ–æœåŠ¡å®ç°**:

1. **WhitelistService**ï¼ˆå¤ç”¨é»‘åå•70%ä»£ç ï¼Œå¤§å¹…ç®€åŒ–ï¼‰:
   - åŸºç¡€CRUDæ“ä½œ
   - ç®€å•æŸ¥è¯¢ç­›é€‰ï¼ˆå»æ‰å¤æ‚ç­›é€‰ï¼‰
   - æ‰¹é‡å¯¼å…¥å¯¼å‡ºï¼ˆç®€åŒ–æ ¼å¼éªŒè¯ï¼‰
   - å»æ‰å¤æ‚çš„å†…å®¹åŒ¹é…

2. **PriorityService**ï¼ˆæ–°å¼€å‘ï¼Œä½†å¾ˆç®€å•ï¼‰:
   ```python
   class PriorityService:
       def check_priority(self, content, enterprise_id):
           """æ£€æŸ¥å†…å®¹ä¼˜å…ˆçº§ï¼Œç®€å•åŒ¹é…"""
           return {
               'has_priority': bool,
               'priority_level': int,  # 1-10
               'is_vip': bool,
               'matches': [...]  # åŒ¹é…çš„ç™½åå•æ¡ç›®
           }
           
       def get_enterprise_vip_status(self, enterprise_id):
           """è·å–ä¼ä¸šVIPçŠ¶æ€"""
           return is_vip_enterprise
   ```

#### ä»»åŠ¡2.2: ç®€å•ç»Ÿè®¡æœåŠ¡ï¼ˆ2å°æ—¶ï¼‰

**ç®€åŒ–ç»Ÿè®¡æœåŠ¡**:
```python
def get_whitelist_statistics(self, enterprise_id, date_range):
    """è·å–ç™½åå•ç»Ÿè®¡ï¼ˆç®€åŒ–ç‰ˆï¼‰"""
    return {
        'total_whitelist_count': int,
        'active_count': int,
        'vip_count': int,
        'priority_distribution': {
            'high': int, 'medium': int, 'low': int
        },
        'recent_additions': int
    }
```

### ç¬¬ä¸‰é˜¶æ®µï¼šç™½åå•APIå±‚ï¼ˆ0.5å¤© / 4å°æ—¶ï¼‰

#### ä»»åŠ¡3.1: ç®€åŒ–APIå®ç°ï¼ˆ4å°æ—¶ï¼‰

**ç®€åŒ–APIç»“æ„**:
```python
pigeon_web/app/api/v1/whitelist/
â”œâ”€â”€ route/
â”‚   â”œâ”€â”€ whitelist.py              # åŸºç¡€CRUD + ç®€å•æŸ¥è¯¢
â”‚   â””â”€â”€ priority.py               # ä¼˜å…ˆçº§æ£€æµ‹
â””â”€â”€ schema/
    â””â”€â”€ whitelist_schema.py       # ç®€åŒ–çš„æ•°æ®éªŒè¯
```

**ç²¾ç®€APIç«¯ç‚¹**ï¼ˆåªä¿ç•™æ ¸å¿ƒ6ä¸ªï¼‰:
```
GET    /api/v1/whitelist/           # ç™½åå•åˆ—è¡¨ï¼ˆç®€å•ç­›é€‰ï¼‰
POST   /api/v1/whitelist/           # åˆ›å»ºç™½åå•æ¡ç›®
PUT    /api/v1/whitelist/<id>       # æ›´æ–°ç™½åå•æ¡ç›®  
DELETE /api/v1/whitelist/<id>       # åˆ é™¤ç™½åå•æ¡ç›®
POST   /api/v1/whitelist/batch      # æ‰¹é‡å¯¼å…¥
POST   /api/v1/whitelist/check      # ä¼˜å…ˆçº§æ£€æµ‹
```

#### ä»»åŠ¡3.2: æ•°æ®éªŒè¯Schemaï¼ˆ2å°æ—¶ï¼‰

**Schemaè®¾è®¡**ï¼ˆåŸºäºé»‘åå•Schemaæ‰©å±•ï¼‰:
```python
class WhitelistCreateSchema(Schema):
    # åŸºç¡€å­—æ®µä¸é»‘åå•ç›¸åŒ
    content = fields.String(required=True, validate=Length(min=1, max=500))
    type_id = fields.UUID(required=True)
    
    # ç™½åå•ç‰¹æœ‰å­—æ®µ
    priority_level = fields.Integer(missing=0, validate=Range(0, 10))
    priority_weight = fields.Decimal(missing=1.0, validate=Range(0.1, 10.0))
    is_vip = fields.Boolean(missing=False)
    vip_level = fields.Integer(allow_none=True, validate=Range(1, 5))

class PriorityConfigSchema(Schema):
    """ä¼˜å…ˆçº§é…ç½®Schema"""
    default_priority = fields.Integer(required=True, validate=Range(0, 10))
    priority_boost = fields.Integer(missing=0, validate=Range(0, 5))
    conflict_resolution = fields.String(missing='highest')
```

### ç¬¬å››é˜¶æ®µï¼šç™½åå•å‰ç«¯ç•Œé¢ï¼ˆ0.5å¤© / 4å°æ—¶ï¼‰

#### ä»»åŠ¡4.1: ç®€åŒ–ç®¡ç†ç•Œé¢ï¼ˆ4å°æ—¶ï¼‰

**ç²¾ç®€å‰ç«¯ç»„ä»¶**ï¼ˆå¤ç”¨é»‘åå•50%ç»„ä»¶ï¼‰:
```typescript
frontend/src/pages/WhitelistManagement/
â”œâ”€â”€ WhitelistPage.tsx                    # ä¸»é¡µé¢ï¼ˆç®€åŒ–ç‰ˆï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ WhitelistTable.tsx              # åˆ—è¡¨ï¼ˆå»æ‰å¤æ‚ç­›é€‰ï¼‰
â”‚   â”œâ”€â”€ WhitelistModal.tsx              # åˆ›å»º/ç¼–è¾‘ï¼ˆç®€åŒ–è¡¨å•ï¼‰
â”‚   â”œâ”€â”€ PrioritySlider.tsx              # ä¼˜å…ˆçº§æ»‘å—ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ VipBadge.tsx                    # VIPæ ‡è¯†ï¼ˆæ–°å¢ï¼‰
â”‚   â””â”€â”€ BatchImportModal.tsx            # æ‰¹é‡å¯¼å…¥ï¼ˆç®€åŒ–ï¼‰
â””â”€â”€ hooks/
    â””â”€â”€ useWhitelist.ts                 # åŸºç¡€æ“ä½œhooks
```

**ç®€åŒ–ç•Œé¢åŠŸèƒ½**:
- **ç®€å•åˆ—è¡¨**: å†…å®¹ã€ç±»å‹ã€ä¼˜å…ˆçº§ã€VIPæ ‡è¯†ã€çŠ¶æ€
- **ç®€å•è¡¨å•**: å†…å®¹è¾“å…¥ã€ç±»å‹é€‰æ‹©ã€ä¼˜å…ˆçº§æ»‘å—ã€VIPå‹¾é€‰
- **VIPæ ‡è¯†**: ç®€å•çš„VIPå¾½ç« æ˜¾ç¤º
- **æ‰¹é‡å¯¼å…¥**: ç®€åŒ–çš„Excel/CSVå¯¼å…¥

#### ä»»åŠ¡4.2: ä¼˜å…ˆçº§å¯è§†åŒ–ç»„ä»¶ï¼ˆ4å°æ—¶ï¼‰

**æ–°å¢å¯è§†åŒ–ç»„ä»¶**:
1. **PriorityLevelSlider**: ä¼˜å…ˆçº§ç­‰çº§æ»‘å—é€‰æ‹©å™¨
2. **VipBadge**: VIPæ ‡è¯†å¾½ç« ç»„ä»¶  
3. **PriorityChart**: ä¼˜å…ˆçº§æ•ˆæœå›¾è¡¨
4. **ConflictResolutionConfig**: å†²çªå¤„ç†è§„åˆ™é…ç½®å™¨

```typescript
// ä¼˜å…ˆçº§é€‰æ‹©å™¨ç»„ä»¶
const PriorityLevelSlider: React.FC<{
  value: number;
  onChange: (value: number) => void;
  showVipBoost?: boolean;
}> = ({ value, onChange, showVipBoost }) => {
  const marks = {
    0: 'ä½',
    3: 'ä¸­', 
    7: 'é«˜',
    10: 'VIP'
  };
  
  return (
    <Slider
      marks={marks}
      min={0} 
      max={10}
      value={value}
      onChange={onChange}
      tooltip={{ formatter: getPriorityLabel }}
    />
  );
};
```

## ğŸ”§ æŠ€æœ¯å®ç°æ¶æ„

### æ•°æ®åº“è®¾è®¡åŸåˆ™
1. **æ¶æ„å¤ç”¨**: 95%å¤ç”¨é»‘åå•è¡¨ç»“æ„ï¼Œè°ƒæ•´å­—æ®µè¯­ä¹‰
2. **ä¼˜å…ˆçº§ç´¢å¼•**: é’ˆå¯¹ä¼˜å…ˆçº§æŸ¥è¯¢ä¼˜åŒ–ç´¢å¼•è®¾è®¡
3. **VIPéš”ç¦»**: VIPæ•°æ®é€»è¾‘åˆ†ç¦»ä½†ç‰©ç†å­˜å‚¨ç»Ÿä¸€
4. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜å…ˆçº§å¤„ç†<50msï¼Œæ”¯æŒé«˜å¹¶å‘æŸ¥è¯¢

### APIè®¾è®¡è§„èŒƒ
1. **RESTfulä¸€è‡´æ€§**: ä¸é»‘åå•APIä¿æŒä¸€è‡´çš„è®¾è®¡é£æ ¼
2. **ä¼˜å…ˆçº§è¯­ä¹‰**: APIå“åº”ä½“ç°ä¼˜å…ˆçº§æ¦‚å¿µè€Œéæ‹¦æˆªæ¦‚å¿µ
3. **VIPä¸“å±æ¥å£**: æ–°å¢VIPä¸“å±ç®¡ç†æ¥å£
4. **å‘åå…¼å®¹**: ç¡®ä¿ä¸ç°æœ‰ç³»ç»Ÿçš„å…¼å®¹æ€§

### å‰ç«¯æŠ€æœ¯è§„èŒƒ
1. **ç»„ä»¶å¤ç”¨**: æœ€å¤§åŒ–å¤ç”¨é»‘åå•ç»„ä»¶ï¼Œå‡å°‘å¼€å‘æˆæœ¬
2. **ä¼˜å…ˆçº§UI**: æ–°å¢ä¼˜å…ˆçº§ç›¸å…³çš„äº¤äº’ç»„ä»¶
3. **çŠ¶æ€ç®¡ç†**: RTK Queryç»Ÿä¸€ç®¡ç†ç™½åå•çŠ¶æ€
4. **ç±»å‹å®‰å…¨**: TypeScriptä¸¥æ ¼ç±»å‹æ£€æŸ¥

## ğŸ“ ç²¾ç®€æ–‡ä»¶ç»“æ„

### åç«¯æ–°å¢æ–‡ä»¶ï¼ˆçº¦8ä¸ªæ–‡ä»¶ï¼Œæ¯”é»‘åå•å°‘60%ï¼‰
```
pigeon_web/app/
â”œâ”€â”€ models/whitelist/                    # æ•°æ®æ¨¡å‹ (2ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ whitelist.py                    # ç®€åŒ–ç‰ˆï¼Œå»æ‰å¤æ‚å­—æ®µ
â”‚   â””â”€â”€ process_log.py                  # å¤„ç†è®°å½•ï¼ˆç®€åŒ–ç‰ˆï¼‰
â”œâ”€â”€ services/whitelist/                  # ä¸šåŠ¡æœåŠ¡ (2ä¸ªæ–‡ä»¶)  
â”‚   â”œâ”€â”€ whitelist_service.py            # åŸºç¡€CRUDï¼ˆç®€åŒ–70%ï¼‰
â”‚   â””â”€â”€ priority_service.py             # ä¼˜å…ˆçº§å¤„ç†ï¼ˆæ–°å¼€å‘ï¼Œç®€å•ï¼‰
â””â”€â”€ api/v1/whitelist/                    # APIæ¥å£ (4ä¸ªæ–‡ä»¶)
    â”œâ”€â”€ route/ (2ä¸ªè·¯ç”±æ–‡ä»¶)            # åªä¿ç•™æ ¸å¿ƒç«¯ç‚¹
    â””â”€â”€ schema/ (2ä¸ªSchemaæ–‡ä»¶)         # ç®€åŒ–éªŒè¯è§„åˆ™
```

### å‰ç«¯æ–°å¢æ–‡ä»¶ï¼ˆçº¦8ä¸ªæ–‡ä»¶ï¼Œæ¯”é»‘åå•å°‘47%ï¼‰
```
frontend/src/
â”œâ”€â”€ api/whitelistApi.ts                 # ç®€åŒ–APIï¼ˆ6ä¸ªç«¯ç‚¹ï¼‰
â”œâ”€â”€ store/slices/whitelistSlice.ts      # åŸºç¡€çŠ¶æ€ç®¡ç†
â”œâ”€â”€ types/entities/whitelist.ts         # ç®€åŒ–ç±»å‹å®šä¹‰
â”œâ”€â”€ pages/WhitelistManagement/          # é¡µé¢ç»„ä»¶ (5ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ WhitelistPage.tsx              # ç®€åŒ–ä¸»é¡µé¢
â”‚   â”œâ”€â”€ components/ (4ä¸ªç»„ä»¶)          # ç²¾ç®€æ ¸å¿ƒç»„ä»¶
â”‚   â””â”€â”€ hooks/ (1ä¸ªhook)               # åŸºç¡€æ“ä½œhook
```

## ğŸ“ˆ ç®€åŒ–å¼€å‘æ•ˆç‡åˆ†æ

### ä¸é»‘åå•åŠŸèƒ½å¯¹æ¯”
| å¼€å‘å†…å®¹ | é»‘åå•ç³»ç»Ÿ | ç™½åå•ç³»ç»Ÿ | ç®€åŒ–ç¨‹åº¦ |
|---------|-----------|-----------|----------|
| æ•°æ®æ¨¡å‹å¤æ‚åº¦ | å¤æ‚ï¼ˆ4ä¸ªæ¨¡å‹ï¼‰ | ç®€åŒ–ï¼ˆ2ä¸ªæ¨¡å‹ï¼‰ | ç®€åŒ–50% |
| æœåŠ¡é€»è¾‘å¤æ‚åº¦ | å¤æ‚åŒ¹é…å¼•æ“ | ç®€å•ä¼˜å…ˆçº§ | ç®€åŒ–70% |
| APIç«¯ç‚¹æ•°é‡ | 12ä¸ªç«¯ç‚¹ | 6ä¸ªç«¯ç‚¹ | ç®€åŒ–50% |
| å‰ç«¯ç»„ä»¶æ•°é‡ | 10+ç»„ä»¶ | 5ä¸ªç»„ä»¶ | ç®€åŒ–50% |

### å·¥æ—¶åˆ†é…ï¼ˆ20å°æ—¶æ€»è®¡ï¼‰
- **æ•°æ®å»ºæ¨¡**: 4å°æ—¶ï¼ˆé»‘åå•ç”¨äº†8å°æ—¶ï¼‰
- **åç«¯æœåŠ¡**: 8å°æ—¶ï¼ˆé»‘åå•ç”¨äº†12å°æ—¶ï¼‰
- **APIæ¥å£**: 4å°æ—¶ï¼ˆé»‘åå•ç”¨äº†6å°æ—¶ï¼‰  
- **å‰ç«¯ç•Œé¢**: 4å°æ—¶ï¼ˆé»‘åå•ç”¨äº†8å°æ—¶ï¼‰
- **æ€»è®¡**: **20å°æ—¶**ï¼ˆé»‘åå•ç”¨äº†34å°æ—¶ï¼Œç®€åŒ–41%ï¼‰

## âš ï¸ é£é™©æ§åˆ¶å’ŒæŠ€æœ¯æŒ‘æˆ˜

### ä¸šåŠ¡é€»è¾‘é£é™©
1. **ä¼˜å…ˆçº§å†²çª**: ä¸åŒä¼˜å…ˆçº§ç™½åå•å†²çªæ—¶çš„å¤„ç†ç­–ç•¥
2. **VIPæ»¥ç”¨**: VIPä¼˜å…ˆçº§è¢«æ»¥ç”¨å½±å“æ•´ä½“æ€§èƒ½
3. **ä¼˜å…ˆçº§è†¨èƒ€**: ä¼˜å…ˆçº§ç­‰çº§è¿‡å¤šå¯¼è‡´ç®¡ç†å¤æ‚
4. **æ€§èƒ½å½±å“**: ä¼˜å…ˆçº§å¤„ç†å¯¹ç³»ç»Ÿæ€§èƒ½çš„å½±å“

### æŠ€æœ¯å®ç°æŒ‘æˆ˜
1. **ä¼˜å…ˆçº§ç®—æ³•**: è®¾è®¡é«˜æ•ˆçš„ä¼˜å…ˆçº§è®¡ç®—å’Œå†²çªè§£å†³ç®—æ³•
2. **VIPéš”ç¦»**: ä¿è¯VIPåŠŸèƒ½çš„å®‰å…¨æ€§å’Œç‹¬ç«‹æ€§
3. **æ€§èƒ½ä¼˜åŒ–**: ä¼˜å…ˆçº§æŸ¥è¯¢å’Œå¤„ç†çš„æ€§èƒ½ä¼˜åŒ–
4. **æ•°æ®ä¸€è‡´æ€§**: ç™½åå•ä¸é»‘åå•ä¹‹é—´çš„æ•°æ®ä¸€è‡´æ€§

### è§£å†³æ–¹æ¡ˆ
1. **ä¼˜å…ˆçº§çŸ©é˜µ**: å»ºç«‹æ¸…æ™°çš„ä¼˜å…ˆçº§å†³ç­–çŸ©é˜µ
2. **ç¼“å­˜ç­–ç•¥**: é«˜é¢‘ä¼˜å…ˆçº§æŸ¥è¯¢ç»“æœç¼“å­˜
3. **å¼‚æ­¥å¤„ç†**: éå…³é”®ä¼˜å…ˆçº§å¤„ç†é‡‡ç”¨å¼‚æ­¥æ¨¡å¼
4. **ç›‘æ§å‘Šè­¦**: å»ºç«‹ä¼˜å…ˆçº§æ•ˆæœç›‘æ§å’Œå¼‚å¸¸å‘Šè­¦

## ğŸš€ ç®€åŒ–æ—¶é—´è§„åˆ’

### ç²¾ç®€æ—¶é—´å®‰æ’ï¼ˆ2.5å¤© / 20å°æ—¶ï¼‰

**Day 1 ä¸Šåˆ (4å°æ—¶)**: æ•°æ®æ¨¡å‹
- 2å°æ—¶ï¼šç®€åŒ–æ•°æ®æ¨¡å‹è®¾è®¡ï¼ˆ2ä¸ªè¡¨ï¼‰
- 2å°æ—¶ï¼šæ•°æ®åº“è¿ç§»è„šæœ¬

**Day 1 ä¸‹åˆ + Day 2 ä¸Šåˆ (8å°æ—¶)**: åç«¯æœåŠ¡
- 6å°æ—¶ï¼šWhitelistServiceï¼ˆåŸºç¡€CRUDï¼‰
- 2å°æ—¶ï¼šPriorityServiceï¼ˆç®€å•ä¼˜å…ˆçº§å¤„ç†ï¼‰

**Day 2 ä¸‹åˆ (4å°æ—¶)**: APIæ¥å£
- 4å°æ—¶ï¼š6ä¸ªæ ¸å¿ƒAPIç«¯ç‚¹ + ç®€åŒ–Schema

**Day 3 ä¸Šåˆ (4å°æ—¶)**: å‰ç«¯ç•Œé¢
- 4å°æ—¶ï¼šç®€åŒ–ç®¡ç†ç•Œé¢ï¼ˆåˆ—è¡¨+è¡¨å•+ä¼˜å…ˆçº§ç»„ä»¶ï¼‰

### é‡Œç¨‹ç¢‘æ£€æŸ¥ç‚¹
- **Day 1 End**: æ•°æ®åº“schemaå®Œæˆï¼Œå¯æ‰§è¡ŒåŸºç¡€æŸ¥è¯¢
- **Day 2 End**: åç«¯æœåŠ¡å®Œæˆï¼Œå¯å¤„ç†ä¼˜å…ˆçº§é€»è¾‘  
- **Day 3 End**: APIæ¥å£å®Œæˆï¼Œå‰åç«¯å¯è”è°ƒ
- **Day 4 End**: å‰ç«¯ç•Œé¢å®Œæˆï¼ŒåŠŸèƒ½æµ‹è¯•é€šè¿‡

## ğŸ’¡ ç®€åŒ–éªŒæ”¶æ ‡å‡†

### åŠŸèƒ½éªŒæ”¶ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰
- [ ] ç™½åå•åŸºç¡€CRUDåŠŸèƒ½æ­£å¸¸
- [ ] ä¼˜å…ˆçº§è®¾ç½®å’Œæ˜¾ç¤ºæ­£å¸¸
- [ ] VIPæ ‡è®°åŠŸèƒ½æ­£å¸¸
- [ ] ç®€å•æ‰¹é‡å¯¼å…¥åŠŸèƒ½ç¨³å®š
- [ ] ä¼˜å…ˆçº§æ£€æµ‹APIæ­£å¸¸å·¥ä½œ

### æ€§èƒ½éªŒæ”¶ï¼ˆç®€åŒ–è¦æ±‚ï¼‰
- [ ] åˆ—è¡¨æŸ¥è¯¢å“åº”æ—¶é—´<1s
- [ ] ä¼˜å…ˆçº§æ£€æµ‹å“åº”æ—¶é—´<200ms
- [ ] æ”¯æŒä¸‡çº§ç™½åå•æ•°æ®ï¼ˆé™ä½è¦æ±‚ï¼‰

### å®‰å…¨éªŒæ”¶ï¼ˆåŸºç¡€å®‰å…¨ï¼‰
- [ ] åŸºç¡€æƒé™æ§åˆ¶æœ‰æ•ˆ
- [ ] ä¼ä¸šæ•°æ®éš”ç¦»æ­£å¸¸

## ğŸ“‹ åç»­æ‰©å±•è§„åˆ’

### Phase 2: æ™ºèƒ½ä¼˜å…ˆçº§ç®¡ç†ï¼ˆé¢„è®¡1å‘¨ï¼‰
- **æœºå™¨å­¦ä¹ ä¼˜å…ˆçº§**: åŸºäºå†å²æ•°æ®æ™ºèƒ½è°ƒæ•´ä¼˜å…ˆçº§
- **åŠ¨æ€ä¼˜å…ˆçº§**: æ ¹æ®å®æ—¶ä¸šåŠ¡æƒ…å†µåŠ¨æ€è°ƒæ•´
- **ä¼˜å…ˆçº§é¢„æµ‹**: é¢„æµ‹ä¼˜å…ˆçº§è®¾ç½®çš„æ•ˆæœ
- **A/Bæµ‹è¯•**: ä¼˜å…ˆçº§ç­–ç•¥çš„A/Bæµ‹è¯•åŠŸèƒ½

### Phase 3: é«˜çº§VIPæœåŠ¡ï¼ˆé¢„è®¡3å¤©ï¼‰  
- **VIPç­‰çº§ä½“ç³»**: å¤šçº§VIPç­‰çº§ç®¡ç†
- **VIPä¸“å±é€šé“**: ç‹¬ç«‹çš„VIPå‘é€é€šé“
- **VIPæ•ˆæœç›‘æ§**: å®æ—¶VIPæœåŠ¡æ•ˆæœç›‘æ§
- **VIPæŠ¥å‘Šç³»ç»Ÿ**: VIPä¸“å±æœåŠ¡æŠ¥å‘Š

### Phase 4: ä¸ç°æœ‰ç³»ç»Ÿé›†æˆï¼ˆé¢„è®¡2å¤©ï¼‰
- **ä¸é»‘åå•è”åŠ¨**: ç™½åå•ä¼˜å…ˆçº§é«˜äºé»‘åå•
- **ä¸å‘é€ç³»ç»Ÿé›†æˆ**: å®æ—¶ä¼˜å…ˆçº§å¤„ç†
- **ä¸ç»Ÿè®¡ç³»ç»Ÿé›†æˆ**: ä¼˜å…ˆçº§æ•ˆæœç»Ÿè®¡
- **ä¸å‘Šè­¦ç³»ç»Ÿé›†æˆ**: ä¼˜å…ˆçº§å¼‚å¸¸å‘Šè­¦

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´**: 2025-01-11  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**é¢„è®¡å¼€å§‹æ—¶é—´**: å¾…ç”¨æˆ·ç¡®è®¤  
**é¢„è®¡å®Œæˆæ—¶é—´**: å¼€å§‹å4ä¸ªå·¥ä½œæ—¥  
**è´Ÿè´£äºº**: Claude Code Assistant  
**æŠ€æœ¯æ¶æ„**: å¤ç”¨é»‘åå•ç³»ç»Ÿï¼Œæ‰©å±•ä¼˜å…ˆçº§ç®¡ç†  
**å¼€å‘æ•ˆç‡é¢„ä¼°**: ç›¸æ¯”ä»é›¶å¼€å‘èŠ‚çœ37%æ—¶é—´ï¼Œä»£ç å¤ç”¨ç‡83%