# V1 ä»£ç æ¸…ç†æŒ‡å¯¼æ–‡æ¡£

> åˆ›å»ºæ—¶é—´ï¼š2025-10-29
> çŠ¶æ€ï¼šå¾…å®¡æ ¸

## ä¸€ã€é‡è¦æ¾„æ¸…ï¼šä»€ä¹ˆæ˜¯"V1åƒåœ¾ä»£ç "

### 1.1 é¡¹ç›®APIç‰ˆæœ¬ç°çŠ¶

ç»è¿‡å…¨é¢ä»£ç åˆ†æï¼Œé¡¹ç›®çš„APIç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š

| APIæ¨¡å— | V1ç‰ˆæœ¬ | V2ç‰ˆæœ¬ | å‰ç«¯ä½¿ç”¨ç‰ˆæœ¬ | å¤‡æ³¨ |
|---------|--------|--------|--------------|------|
| SMS | âœ… å­˜åœ¨ï¼ˆlegacyï¼‰ | âœ… å­˜åœ¨ | V2 | **å¯æ¸…ç†V1** |
| è®¤è¯ï¼ˆauthï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| å‘é€è´¦å·ï¼ˆsending-accountsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| é€šé“ï¼ˆchannelsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| é»‘åå•ï¼ˆblacklistsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| ç™½åå•ï¼ˆwhitelistsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| ç®¡ç†ç”¨æˆ·ï¼ˆadmin-usersï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| è§’è‰²æƒé™ï¼ˆroles/permissionsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| ä¾›åº”å•†ï¼ˆvendorsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| æ•æ„Ÿè¯ï¼ˆsensitive-wordsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| é€šé“åˆ†ç»„ï¼ˆchannel-groupsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| ä»·æ ¼ç®¡ç†ï¼ˆpricesï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| å¹³å°é”™è¯¯ï¼ˆplatform-errorsï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |
| å…¶ä»–ï¼ˆenterprises/feishu/logsç­‰ï¼‰ | âœ… å­˜åœ¨ | âŒ æ—  | V1 | æ´»è·ƒä½¿ç”¨ |

**å…³é”®ç»“è®ºï¼š**
- âœ… **åªæœ‰SMSæ¨¡å—æœ‰V2ç‰ˆæœ¬**
- âŒ **å…¶ä»–13ä¸ªæ¨¡å—åªæœ‰V1ç‰ˆæœ¬ï¼Œå®ƒä»¬ä¸æ˜¯"åƒåœ¾ä»£ç "ï¼Œè€Œæ˜¯é¡¹ç›®çš„æ ¸å¿ƒAPI**
- âœ… **çœŸæ­£çš„"åƒåœ¾ä»£ç "ä»…é™äºSMSæ¨¡å—çš„V1ç«¯ç‚¹å’Œç›¸å…³æµ‹è¯•**

### 1.2 è¯¯è§£æ¾„æ¸…ï¼šURLè·¯å¾„ vs APIç‰ˆæœ¬

é¡¹ç›®ä¸­å­˜åœ¨URLè·¯å¾„è¿ç§»ï¼ˆFEAT-1-2ï¼‰ï¼Œä½†è¿™**ä¸æ˜¯APIç‰ˆæœ¬å‡çº§**ï¼š

```
æ—§è·¯å¾„: /api/v1/accounts/*         â†’ æ–°è·¯å¾„: /api/v1/sending-accounts/*
                â†‘                                      â†‘
              ä»æ˜¯V1                                 ä»æ˜¯V1
```

è¿™æ˜¯URLé‡å‘½åï¼Œä¸æ˜¯V1â†’V2çš„ç‰ˆæœ¬å‡çº§ã€‚

---

## äºŒã€å¯ä»¥å®‰å…¨æ¸…ç†çš„ä»£ç èŒƒå›´

### 2.1 SMSæ¨¡å—çš„V1ä»£ç 

#### åç«¯è·¯ç”±ï¼ˆå¯åˆ é™¤ï¼‰

**æ–‡ä»¶ä½ç½®ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/app/api/v1/sms/route/routes.py`

**å¯åˆ é™¤çš„è·¯ç”±æ³¨å†Œï¼ˆç¬¬32-41è¡Œï¼‰ï¼š**
```python
# Register routes - V1 (legacy)
api.add_resource(OutboxListResource, '/outbox')
api.add_resource(OutboxDetailResource, '/outbox/<string:message_id>')
api.add_resource(OutboxCostResource, '/outbox/<string:message_id>/cost')
api.add_resource(InboxListResource, '/inbox')
api.add_resource(InboxDetailResource, '/inbox/<string:message_id>')
api.add_resource(StatisticsResource, '/statistics')
api.add_resource(OverviewResource, '/overview')
api.add_resource(OutboxExportResource, '/outbox/export')
api.add_resource(InboxExportResource, '/inbox/export')
```

**å¯¹åº”çš„ç«¯ç‚¹ï¼š**
- `GET /api/v1/sms/outbox` â†’ å·²è¢« `GET /api/v1/sms/v2/outbox` æ›¿ä»£
- `GET /api/v1/sms/outbox/<message_id>` â†’ å·²è¢« `GET /api/v1/sms/v2/outbox/<message_id>` æ›¿ä»£
- `POST /api/v1/sms/outbox/export` â†’ å·²è¢« `POST /api/v1/sms/v2/outbox/export` æ›¿ä»£
- `GET /api/v1/sms/outbox/<message_id>/cost` â†’ V2æœªå®ç°ï¼Œéœ€ç¡®è®¤æ˜¯å¦è¿˜éœ€è¦
- `GET /api/v1/sms/inbox` â†’ éœ€ç¡®è®¤æ˜¯å¦å·²æœ‰V2ç‰ˆæœ¬
- `GET /api/v1/sms/inbox/<message_id>` â†’ éœ€ç¡®è®¤æ˜¯å¦å·²æœ‰V2ç‰ˆæœ¬
- `POST /api/v1/sms/inbox/export` â†’ éœ€ç¡®è®¤æ˜¯å¦å·²æœ‰V2ç‰ˆæœ¬
- `GET /api/v1/sms/statistics` â†’ éœ€ç¡®è®¤æ˜¯å¦å·²æœ‰V2ç‰ˆæœ¬
- `GET /api/v1/sms/overview` â†’ éœ€ç¡®è®¤æ˜¯å¦å·²æœ‰V2ç‰ˆæœ¬

#### åç«¯Resourceç±»ï¼ˆå¯åˆ é™¤ï¼‰

| æ–‡ä»¶ | ç±»å | ç«¯ç‚¹ | V2æ›¿ä»£ |
|------|------|------|--------|
| `app/api/v1/sms/route/outbox.py` | `OutboxListResource` | `GET /outbox` | âœ… `OutboxListResourceV2` |
| `app/api/v1/sms/route/outbox.py` | `OutboxDetailResource` | `GET /outbox/<id>` | âœ… `OutboxDetailResourceV2` |
| `app/api/v1/sms/route/outbox.py` | `OutboxExportResource` | `POST /outbox/export` | âœ… `OutboxExportResourceV2` |
| `app/api/v1/sms/route/outbox_cost.py` | `OutboxCostResource` | `GET /outbox/<id>/cost` | â“ å¾…ç¡®è®¤ |
| `app/api/v1/sms/route/inbox.py` | `InboxListResource` | `GET /inbox` | â“ å¾…ç¡®è®¤ |
| `app/api/v1/sms/route/inbox.py` | `InboxDetailResource` | `GET /inbox/<id>` | â“ å¾…ç¡®è®¤ |
| `app/api/v1/sms/route/inbox.py` | `InboxExportResource` | `POST /inbox/export` | â“ å¾…ç¡®è®¤ |
| `app/api/v1/sms/route/statistics.py` | `StatisticsResource` | `GET /statistics` | â“ å¾…ç¡®è®¤ |
| `app/api/v1/sms/route/statistics.py` | `OverviewResource` | `GET /overview` | â“ å¾…ç¡®è®¤ |

### 2.2 SMSæ¨¡å—çš„V1æµ‹è¯•ä»£ç 

#### å•å…ƒæµ‹è¯•ï¼ˆå¯åˆ é™¤/æ›´æ–°ï¼‰

**æ–‡ä»¶ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/tests/api/sms/test_outbox_routes.py`
- **æµ‹è¯•æ•°é‡ï¼š** 11ä¸ªæµ‹è¯•å‡½æ•°
- **æµ‹è¯•å†…å®¹ï¼š** æµ‹è¯•V1 outbox APIç«¯ç‚¹
- **å¤„ç†æ–¹æ¡ˆï¼š**
  - é€‰é¡¹Aï¼šå®Œå…¨åˆ é™¤ï¼ˆå¦‚æœV2å·²æœ‰å®Œæ•´æµ‹è¯•è¦†ç›–ï¼‰
  - é€‰é¡¹Bï¼šæ”¹å†™ä¸ºæµ‹è¯•V2ç«¯ç‚¹ï¼ˆå¦‚æœV2æµ‹è¯•è¦†ç›–ä¸è¶³ï¼‰

#### é›†æˆæµ‹è¯•ï¼ˆéœ€æ›´æ–°ï¼‰

**æ–‡ä»¶1ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/tests/integration/tests/sms/test_sms_outbox_query.py`
```python
# ç¬¬34è¡Œï¼Œä½¿ç”¨äº† V1 API
response = requests.get(
    f"{integration_base_url}/sms/outbox",  # V1ç«¯ç‚¹
    params={...},
    headers=user_headers
)
```
**å¤„ç†æ–¹æ¡ˆï¼š** æ›´æ–°ä¸º `{integration_base_url}/sms/v2/outbox`

**æ–‡ä»¶2ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/tests/integration/tests/prices/test_price_db_features.py`
- ä½¿ç”¨äº† `/sms/outbox/<id>/cost` ç«¯ç‚¹
- éœ€ç¡®è®¤æ˜¯å¦æœ‰V2æ›¿ä»£

**æ–‡ä»¶3ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/tests/integration/tests/sms/test_sms_status_workflow.py`
- ä½¿ç”¨äº† `/sms/v2/outbox` ï¼ˆè¿™ä¸ªå·²ç»æ˜¯V2ï¼Œæ— éœ€æ›´æ”¹ï¼‰

**æ–‡ä»¶4ï¼š** `/Users/yukun-admin/projects/pigeon/pigeon_web/tests/integration/debug_query.py`
- è°ƒè¯•è„šæœ¬ï¼Œä½¿ç”¨äº† `/sms/v2/` ï¼ˆå·²ç»æ˜¯V2ï¼‰

### 2.3 å‰ç«¯ä»£ç ï¼ˆå·²è¿ç§»ï¼Œæ— éœ€æ¸…ç†ï¼‰

å‰ç«¯å·²ç»å®Œå…¨è¿ç§»åˆ°V2ï¼š
```typescript
// frontend/src/api/outboxApi.ts
url: `/sms/v2/outbox?${queryParts.join('&')}`,  // ç¬¬67è¡Œ
url: `/sms/v2/outbox/${messageId}`,              // ç¬¬75è¡Œ
url: '/sms/v2/outbox/export',                    // ç¬¬82è¡Œ
url: `/sms/v2/outbox/${messageId}/resend-receipt` // ç¬¬106è¡Œ
```

**ç»“è®ºï¼š** å‰ç«¯å·²å®Œæˆè¿ç§»ï¼Œä¸éœ€è¦ä»»ä½•æ›´æ”¹ã€‚

---

## ä¸‰ã€æ¸…ç†å‰å¿…é¡»ç¡®è®¤çš„é—®é¢˜

### 3.1 åŠŸèƒ½è¦†ç›–ç¡®è®¤

| V1ç«¯ç‚¹ | V2æ˜¯å¦å®ç° | çŠ¶æ€ | å¦‚æœªå®ç°çš„å¤„ç†æ–¹æ¡ˆ |
|--------|-----------|------|--------------------|
| `GET /sms/outbox` | âœ… | å¯åˆ é™¤ | - |
| `GET /sms/outbox/<id>` | âœ… | å¯åˆ é™¤ | - |
| `POST /sms/outbox/export` | âœ… | å¯åˆ é™¤ | - |
| `GET /sms/outbox/<id>/cost` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |
| `GET /sms/inbox` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |
| `GET /sms/inbox/<id>` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |
| `POST /sms/inbox/export` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |
| `GET /sms/statistics` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |
| `GET /sms/overview` | â“ | **å¾…ç¡®è®¤** | å¦‚æœªå®ç°ï¼Œéœ€å…ˆåœ¨V2ä¸­å®ç° |

**éœ€è¦æ£€æŸ¥çš„æ–‡ä»¶ï¼š**
- `app/api/v1/sms/route/outbox_v2.py` - çœ‹æ˜¯å¦å®ç°äº†æ‰€æœ‰V1åŠŸèƒ½
- `app/api/v1/sms/route/inbox.py` - æ˜¯å¦æœ‰å¯¹åº”çš„inbox_v2.py
- `app/api/v1/sms/route/statistics.py` - æ˜¯å¦æœ‰å¯¹åº”çš„statistics_v2.py

### 3.2 æµ‹è¯•è¦†ç›–ç¡®è®¤

**é—®é¢˜ï¼š** åˆ é™¤V1æµ‹è¯•åï¼ŒV2æ˜¯å¦æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–ï¼Ÿ

**æ£€æŸ¥æ¸…å•ï¼š**
- [ ] æ˜¯å¦å­˜åœ¨ `tests/api/sms/test_outbox_v2_routes.py` æˆ–ç±»ä¼¼çš„V2æµ‹è¯•æ–‡ä»¶ï¼Ÿ
- [ ] V2æµ‹è¯•æ˜¯å¦è¦†ç›–äº†æ‰€æœ‰V1æµ‹è¯•çš„åœºæ™¯ï¼Ÿ
- [ ] é›†æˆæµ‹è¯•æ˜¯å¦å·²å…¨é¢æ›´æ–°ä¸ºä½¿ç”¨V2ç«¯ç‚¹ï¼Ÿ

---

## å››ã€å®‰å…¨æ¸…ç†æ­¥éª¤ï¼ˆåˆ†é˜¶æ®µæ‰§è¡Œï¼‰

### é˜¶æ®µ1ï¼šåŠŸèƒ½ç¡®è®¤ï¼ˆä¸ä¿®æ”¹ä»£ç ï¼‰

#### æ­¥éª¤1.1ï¼šæ£€æŸ¥V2 APIå®ç°å®Œæ•´æ€§
```bash
cd /Users/yukun-admin/projects/pigeon/pigeon_web

# æŸ¥çœ‹V2å®ç°çš„æ‰€æœ‰ç«¯ç‚¹
grep -r "api.add_resource" app/api/v1/sms/route/routes.py
```

#### æ­¥éª¤1.2ï¼šæŸ¥æ‰¾V2çš„inbox/statisticså®ç°
```bash
# æŸ¥æ‰¾æ˜¯å¦æœ‰inbox_v2.py
find app/api/v1/sms/route/ -name "*v2*"

# æŸ¥æ‰¾æ˜¯å¦æœ‰inboxçš„V2å®ç°
grep -r "InboxResourceV2\|InboxListResourceV2" app/api/v1/sms/
grep -r "StatisticsResourceV2" app/api/v1/sms/
```

#### æ­¥éª¤1.3ï¼šæ£€æŸ¥V2æµ‹è¯•è¦†ç›–
```bash
# æŸ¥æ‰¾V2ç›¸å…³çš„æµ‹è¯•æ–‡ä»¶
find tests/ -name "*v2*" -o -name "*outbox*"

# æŸ¥çœ‹æµ‹è¯•å†…å®¹
ls -la tests/api/sms/
ls -la tests/integration/tests/sms/
```

**è¾“å‡ºç»“æœï¼š** å°†ä¸Šè¿°å‘½ä»¤çš„è¾“å‡ºæ•´ç†æˆæ¸…å•ï¼Œç¡®è®¤å“ªäº›åŠŸèƒ½å·²æœ‰V2ç‰ˆæœ¬ã€‚

---

### é˜¶æ®µ2ï¼šå‡†å¤‡è¿ç§»ï¼ˆå¦‚æœ‰ç¼ºå¤±åŠŸèƒ½ï¼‰

**å¦‚æœå‘ç°V2æœªå®ç°æŸäº›V1åŠŸèƒ½ï¼Œéœ€è¦å…ˆå®ç°ï¼š**

#### æ­¥éª¤2.1ï¼šå®ç°ç¼ºå¤±çš„V2ç«¯ç‚¹
1. å‚ç…§ `outbox_v2.py` çš„æ¨¡å¼
2. å®ç° `inbox_v2.py` å’Œ `statistics_v2.py`ï¼ˆå¦‚æœç¼ºå¤±ï¼‰
3. ç¡®ä¿æ”¯æŒæ‹†åˆ†çŸ­ä¿¡æ˜¾ç¤ºç­‰V2ç‰¹æ€§

#### æ­¥éª¤2.2ï¼šè¡¥å……V2æµ‹è¯•
1. åˆ›å»º `tests/api/sms/test_outbox_v2_routes.py`
2. è¦†ç›–æ‰€æœ‰V1æµ‹è¯•çš„åœºæ™¯
3. è¿è¡Œæµ‹è¯•ç¡®ä¿é€šè¿‡ï¼š
   ```bash
   pytest tests/api/sms/test_outbox_v2_routes.py -v
   ```

#### æ­¥éª¤2.3ï¼šæ›´æ–°é›†æˆæµ‹è¯•
```bash
# å°†é›†æˆæµ‹è¯•ä¸­çš„V1ç«¯ç‚¹æ›¿æ¢ä¸ºV2
# éœ€è¦ä¿®æ”¹çš„æ–‡ä»¶ï¼š
# - tests/integration/tests/sms/test_sms_outbox_query.py
# - tests/integration/tests/prices/test_price_db_features.py

# è¿è¡Œé›†æˆæµ‹è¯•ç¡®ä¿é€šè¿‡
cd tests/integration
make test
```

---

### é˜¶æ®µ3ï¼šæ‰§è¡Œæ¸…ç†ï¼ˆç¡®è®¤æ— å½±å“åï¼‰

#### æ­¥éª¤3.1ï¼šåˆ é™¤V1è·¯ç”±æ³¨å†Œï¼ˆä¿ç•™ä»£ç æ–‡ä»¶ï¼‰

**ä¿®æ”¹æ–‡ä»¶ï¼š** `app/api/v1/sms/route/routes.py`

```python
# æ³¨é‡Šæ‰æˆ–åˆ é™¤ V1 è·¯ç”±æ³¨å†Œ
# api.add_resource(OutboxListResource, '/outbox')
# api.add_resource(OutboxDetailResource, '/outbox/<string:message_id>')
# ... å…¶ä»–V1è·¯ç”±
```

**éªŒè¯ï¼š** å¯åŠ¨æœåŠ¡ï¼Œç¡®ä¿å‰ç«¯åŠŸèƒ½æ­£å¸¸ã€‚

#### æ­¥éª¤3.2ï¼šåˆ é™¤V1å•å…ƒæµ‹è¯•
```bash
# å¤‡ä»½æµ‹è¯•æ–‡ä»¶
cp tests/api/sms/test_outbox_routes.py tests/api/sms/test_outbox_routes.py.backup

# åˆ é™¤V1æµ‹è¯•æ–‡ä»¶
rm tests/api/sms/test_outbox_routes.py
```

#### æ­¥éª¤3.3ï¼šåˆ é™¤V1 Resourceç±»æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰

**å¦‚æœç¡®è®¤ä¸å†éœ€è¦ï¼Œå¯ä»¥åˆ é™¤ä»¥ä¸‹æ–‡ä»¶ï¼š**
```bash
# ä»…åœ¨å®Œå…¨ç¡®è®¤åæ‰§è¡Œ
rm app/api/v1/sms/route/outbox.py
rm app/api/v1/sms/route/outbox_cost.py  # ç¡®è®¤coståŠŸèƒ½å·²è¿ç§»
# æ ¹æ®ç¡®è®¤ç»“æœå†³å®šæ˜¯å¦åˆ é™¤ inbox.py å’Œ statistics.py
```

**æ³¨æ„ï¼š** å»ºè®®å…ˆæ³¨é‡Šè·¯ç”±æ³¨å†Œï¼Œè§‚å¯Ÿä¸€æ®µæ—¶é—´åå†åˆ é™¤æ–‡ä»¶ã€‚

---

### é˜¶æ®µ4ï¼šç›‘æ§ä¸å›æ»š

#### æ­¥éª¤4.1ï¼šç›‘æ§æ—¥å¿—
åˆ é™¤V1ç«¯ç‚¹åï¼Œç›‘æ§æ˜¯å¦æœ‰é”™è¯¯è¯·æ±‚ï¼š
```bash
# æŸ¥çœ‹æ˜¯å¦æœ‰å¯¹æ—§ç«¯ç‚¹çš„è®¿é—®
tail -f logs/app.log | grep "/api/v1/sms/outbox"
```

#### æ­¥éª¤4.2ï¼šå‡†å¤‡å›æ»šæ–¹æ¡ˆ
å¦‚æœå‘ç°é—®é¢˜ï¼Œç«‹å³æ¢å¤ï¼š
```bash
# æ¢å¤è·¯ç”±æ³¨å†Œ
git checkout app/api/v1/sms/route/routes.py

# æˆ–ä»å¤‡ä»½æ¢å¤
git stash pop
```

---

## äº”ã€ä¸èƒ½åˆ é™¤çš„ä»£ç ï¼ˆé‡è¦æé†’ï¼‰

### 5.1 å…¶ä»–13ä¸ªæ¨¡å—çš„V1 API

**è¿™äº›ä¸æ˜¯"åƒåœ¾ä»£ç "ï¼Œå®ƒä»¬æ˜¯é¡¹ç›®çš„æ ¸å¿ƒAPIï¼š**

```
âŒ ä¸è¦åˆ é™¤ï¼š
- /api/v1/auth/*
- /api/v1/sending-accounts/*
- /api/v1/channels/*
- /api/v1/blacklists/*
- /api/v1/whitelists/*
- /api/v1/admin-users/*
- /api/v1/roles/*
- /api/v1/permissions/*
- /api/v1/vendors/*
- /api/v1/sensitive-words/*
- /api/v1/channel-groups/*
- /api/v1/channels/prices/*
- /api/v1/platform-errors/*
- ... å…¶ä»–æ‰€æœ‰éSMSæ¨¡å—
```

**åŸå› ï¼š**
1. è¿™äº›æ¨¡å—æ²¡æœ‰V2ç‰ˆæœ¬
2. å‰ç«¯å®Œå…¨ä¾èµ–è¿™äº›V1 API
3. æ‰€æœ‰æµ‹è¯•éƒ½åŸºäºè¿™äº›V1 API
4. åˆ é™¤ä¼šå¯¼è‡´ç³»ç»Ÿå´©æºƒ

### 5.2 URLé‡å†™ä¸­é—´ä»¶

**æ–‡ä»¶ï¼š** `app/middleware/url_rewrite.py`

**ä¸è¦åˆ é™¤åŸå› ï¼š**
- æä¾›å‘åå…¼å®¹æ€§
- æ”¯æŒä» `/api/v1/accounts` åˆ° `/api/v1/sending-accounts` çš„å¹³æ»‘è¿ç§»
- åŒ…å«deprecationè­¦å‘Šæœºåˆ¶
- è¿™ä¸æ˜¯V1â†’V2çš„è¿ç§»ï¼Œè€Œæ˜¯URLè·¯å¾„çš„é‡å‘½å

---

## å…­ã€é£é™©è¯„ä¼°

| æ¸…ç†å†…å®¹ | é£é™©ç­‰çº§ | å½±å“èŒƒå›´ | ç¼“è§£æªæ–½ |
|---------|---------|----------|----------|
| åˆ é™¤SMS V1 outboxç«¯ç‚¹ | ğŸŸ¢ ä½ | ä»…SMSå‘ä»¶ç®± | å‰ç«¯å·²è¿ç§»ï¼Œä½é£é™© |
| åˆ é™¤SMS V1 inboxç«¯ç‚¹ | ğŸŸ¡ ä¸­ | SMSæ”¶ä»¶ç®± | éœ€ç¡®è®¤æ˜¯å¦æœ‰V2ç‰ˆæœ¬ |
| åˆ é™¤SMS V1 statisticsç«¯ç‚¹ | ğŸŸ¡ ä¸­ | SMSç»Ÿè®¡åŠŸèƒ½ | éœ€ç¡®è®¤æ˜¯å¦æœ‰V2ç‰ˆæœ¬ |
| åˆ é™¤SMS V1 costç«¯ç‚¹ | ğŸ”´ é«˜ | ä»·æ ¼æŸ¥è¯¢åŠŸèƒ½ | V2æœªå®ç°ï¼Œä¸èƒ½åˆ é™¤ |
| åˆ é™¤å…¶ä»–æ¨¡å—çš„V1 API | ğŸ”´ æé«˜ | æ•´ä¸ªç³»ç»Ÿ | **ç»å¯¹ç¦æ­¢** |

---

## ä¸ƒã€æ¸…ç†æ£€æŸ¥æ¸…å•

### æ¸…ç†å‰ç¡®è®¤ï¼ˆå¿…é¡»å…¨éƒ¨æ‰“å‹¾ï¼‰

- [ ] å·²ç¡®è®¤æ‰€æœ‰V1åŠŸèƒ½åœ¨V2ä¸­éƒ½æœ‰å®ç°
- [ ] å·²ç¡®è®¤å‰ç«¯ä¸å†è°ƒç”¨ä»»ä½•V1ç«¯ç‚¹
- [ ] å·²ç¡®è®¤V2æœ‰å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- [ ] å·²å°†é›†æˆæµ‹è¯•æ›´æ–°ä¸ºä½¿ç”¨V2ç«¯ç‚¹
- [ ] å·²åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯V2åŠŸèƒ½æ­£å¸¸
- [ ] å·²å¤‡ä»½æ‰€æœ‰è¦åˆ é™¤çš„ä»£ç 
- [ ] å·²å‡†å¤‡å›æ»šæ–¹æ¡ˆ
- [ ] å·²é€šçŸ¥å›¢é˜Ÿæˆå‘˜å³å°†è¿›è¡Œçš„æ¸…ç†æ“ä½œ

### æ¸…ç†åéªŒè¯

- [ ] å‰ç«¯æ‰€æœ‰SMSç›¸å…³åŠŸèƒ½æ­£å¸¸
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆå•å…ƒæµ‹è¯•+é›†æˆæµ‹è¯•ï¼‰
- [ ] æ—¥å¿—ä¸­æ— å¯¹æ—§ç«¯ç‚¹çš„è®¿é—®é”™è¯¯
- [ ] æ•°æ®åº“æ“ä½œæ­£å¸¸
- [ ] æ€§èƒ½æ— æ˜æ˜¾ä¸‹é™

---

## å…«ã€å»ºè®®çš„æ¸…ç†æ—¶é—´è¡¨

| å‘¨æœŸ | ä»»åŠ¡ | ç›®æ ‡ |
|------|------|------|
| ç¬¬1å‘¨ | åŠŸèƒ½ç¡®è®¤ | æ˜ç¡®V2çš„å®Œæ•´æ€§ |
| ç¬¬2å‘¨ | è¡¥å……ç¼ºå¤±åŠŸèƒ½ | å®ç°inbox/statisticsçš„V2ç‰ˆæœ¬ï¼ˆå¦‚éœ€è¦ï¼‰ |
| ç¬¬3å‘¨ | æµ‹è¯•è¿ç§» | æ›´æ–°æ‰€æœ‰æµ‹è¯•åˆ°V2 |
| ç¬¬4å‘¨ | ç°åº¦æµ‹è¯• | åœ¨æµ‹è¯•ç¯å¢ƒå…³é—­V1ç«¯ç‚¹ |
| ç¬¬5å‘¨ | ç”Ÿäº§æ¸…ç† | æ­£å¼åˆ é™¤V1ä»£ç  |
| ç¬¬6å‘¨ | ç›‘æ§è§‚å¯Ÿ | ç¡®è®¤æ— é—ç•™é—®é¢˜ |

---

## ä¹ã€æ€»ç»“ä¸å»ºè®®

### 9.1 æ ¸å¿ƒç»“è®º

1. **çœŸæ­£å¯ä»¥æ¸…ç†çš„ä»£ç é‡å¾ˆå°**
   - åªæœ‰SMSæ¨¡å—çš„V1ä»£ç å¯ä»¥æ¸…ç†
   - çº¦å æ•´ä¸ªV1ä»£ç åº“çš„ < 5%

2. **å¤§éƒ¨åˆ†V1ä»£ç æ˜¯æ ¸å¿ƒåŠŸèƒ½**
   - å…¶ä»–13ä¸ªæ¨¡å—çš„V1 APIä¸æ˜¯"åƒåœ¾"
   - å®ƒä»¬æ˜¯ç³»ç»Ÿçš„ä¸»è¦APIï¼Œæš‚æ— V2ç‰ˆæœ¬

3. **æ¸…ç†éœ€è¦è°¨æ…åˆ†é˜¶æ®µè¿›è¡Œ**
   - å¿…é¡»å…ˆç¡®è®¤V2åŠŸèƒ½å®Œæ•´
   - éœ€è¦å®Œæ•´çš„æµ‹è¯•è¦†ç›–
   - å»ºè®®ç°åº¦å‘å¸ƒ

### 9.2 åç»­è§„åˆ’å»ºè®®

å¦‚æœå¸Œæœ›å…¨é¢æ¸…ç†V1ä»£ç ï¼Œéœ€è¦ï¼š

1. **åˆ¶å®šAPIç‰ˆæœ¬å‡çº§è®¡åˆ’**
   - ä¸ºæ‰€æœ‰æ¨¡å—è®¾è®¡V2ç‰ˆæœ¬
   - å®šä¹‰V2çš„æ”¹è¿›ç›®æ ‡ï¼ˆæ€§èƒ½ã€åŠŸèƒ½ã€æ¶æ„ï¼‰
   - è§„åˆ’è¿ç§»è·¯çº¿å›¾

2. **é€æ¨¡å—è¿ç§»**
   - æŒ‰æ¨¡å—é‡è¦æ€§æ’åº
   - æ¯ä¸ªæ¨¡å—ç‹¬ç«‹å®ç°V2ç‰ˆæœ¬
   - ä¿æŒV1å’ŒV2å…±å­˜ä¸€æ®µæ—¶é—´
   - è®¾ç½®V1çš„sunsetæ—¥æœŸ

3. **å»ºç«‹deprecationæœºåˆ¶**
   - å‚è€ƒFEAT-1-2çš„åšæ³•
   - æ·»åŠ deprecationè­¦å‘Š
   - æä¾›è¿ç§»æŒ‡å—
   - ç»™äºˆè¶³å¤Ÿçš„è¿‡æ¸¡æ—¶é—´

### 9.3 å½“å‰å»ºè®®

**ç«‹å³å¯æ‰§è¡Œï¼š**
1. ç¡®è®¤SMSæ¨¡å—çš„V2åŠŸèƒ½å®Œæ•´æ€§
2. æ›´æ–°é›†æˆæµ‹è¯•åˆ°V2ç«¯ç‚¹
3. åœ¨æµ‹è¯•ç¯å¢ƒè¯•è¿è¡Œå…³é—­V1ç«¯ç‚¹

**æš‚ç¼“æ‰§è¡Œï¼š**
1. åˆ é™¤V1ä»£ç æ–‡ä»¶ï¼ˆå…ˆæ³¨é‡Šè·¯ç”±å³å¯ï¼‰
2. æ¸…ç†å…¶ä»–æ¨¡å—çš„V1ä»£ç ï¼ˆå®ƒä»¬ä¸æ˜¯åƒåœ¾ï¼‰

---

## é™„å½•

### é™„å½•Aï¼šå¿«é€ŸæŸ¥è¯¢å‘½ä»¤

```bash
# æŸ¥æ‰¾æ‰€æœ‰ä½¿ç”¨V1 SMSç«¯ç‚¹çš„ä»£ç 
grep -r "/api/v1/sms/outbox" --include="*.py" --include="*.ts" --include="*.tsx"

# æŸ¥æ‰¾æ‰€æœ‰V2ç«¯ç‚¹
grep -r "/sms/v2/" --include="*.py" --include="*.ts" --include="*.tsx"

# æŸ¥çœ‹SMSæ¨¡å—çš„æ‰€æœ‰è·¯ç”±
grep "api.add_resource" app/api/v1/sms/route/routes.py

# è¿è¡ŒSMSç›¸å…³æµ‹è¯•
pytest tests/api/sms/ -v
pytest tests/integration/tests/sms/ -v
```

### é™„å½•Bï¼šè”ç³»ä¿¡æ¯

å¦‚æœ‰ç–‘é—®ï¼Œè¯·è”ç³»ï¼š
- åç«¯è´Ÿè´£äººï¼šlinquan <linquan.isaac@gmail.com>
- ç³»ç»Ÿæ¶æ„å¸ˆï¼šyukun.xing <xingyukun@gmail.com>
